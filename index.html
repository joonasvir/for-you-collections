<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>For You Collections</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #ffffff;
      color: #1a1a1a;
      min-height: 100vh;
      overflow: hidden;
    }

    /* Three Column Layout */
    .layout {
      display: grid;
      grid-template-columns: 320px 1fr 0px;
      height: 100vh;
      transition: grid-template-columns 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .layout.panel-open {
      grid-template-columns: 320px 1fr 400px;
    }

    /* Left Sidebar */
    .sidebar {
      background: #fafafa;
      border-right: 1px solid #eee;
      padding: 32px 24px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    .sidebar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 32px;
    }

    .sidebar h1 {
      font-size: 1.25rem;
      font-weight: 600;
      color: #1a1a1a;
    }

    .prompts-toggle {
      padding: 6px 10px;
      background: transparent;
      border: 1px solid #ddd;
      color: #888;
      border-radius: 6px;
      font-size: 11px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .prompts-toggle:hover {
      border-color: #bbb;
      color: #666;
    }

    .prompts-toggle.active {
      background: #f0f0f0;
      border-color: #ccc;
      color: #555;
    }

    .section-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: #999;
      margin-bottom: 16px;
    }

    /* Persona Selector */
    .persona-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 32px;
    }

    .persona-btn {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: transparent;
      border: 1px solid transparent;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: left;
    }

    .persona-btn:hover {
      background: #f5f5f5;
    }

    .persona-btn.active {
      background: #f0f0f0;
      border-color: #e0e0e0;
    }

    .persona-avatar {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #eee;
      flex-shrink: 0;
    }

    .persona-btn.active .persona-avatar {
      border-color: #1a1a1a;
    }

    .persona-btn-info {
      flex: 1;
      min-width: 0;
    }

    .persona-btn .name {
      font-size: 14px;
      font-weight: 500;
      color: #666;
      margin-bottom: 2px;
    }

    .persona-btn.active .name {
      color: #1a1a1a;
    }

    .persona-btn .role {
      font-size: 12px;
      color: #999;
    }

    /* Prompt Box */
    .prompt-box {
      background: #f5f5f5;
      border: 1px solid #eee;
      border-radius: 10px;
      padding: 14px;
      margin-bottom: 24px;
      display: none;
    }

    .prompt-box.visible {
      display: block;
    }

    .prompt-box .label {
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #999;
      margin-bottom: 8px;
    }

    .prompt-box pre {
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 10px;
      color: #666;
      white-space: pre-wrap;
      line-height: 1.5;
    }

    /* Persona Details */
    .persona-details {
      flex: 1;
      display: none;
      flex-direction: column;
    }

    .persona-details.visible {
      display: flex;
    }

    .persona-bio {
      color: #666;
      line-height: 1.6;
      font-size: 13px;
      margin-bottom: 20px;
    }

    .memories {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 24px;
    }

    .memory-tag {
      background: #fff;
      border: 1px solid #e5e5e5;
      padding: 6px 10px;
      border-radius: 14px;
      font-size: 11px;
      color: #666;
    }

    .generate-btn {
      padding: 14px 24px;
      background: #1a1a1a;
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s;
      margin-top: auto;
    }

    .generate-btn:hover {
      background: #333;
    }

    .generate-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    /* Main Content - Card Stack */
    .main {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
      background: #f5f5f5;
      position: relative;
    }

    .card-area {
      width: 100%;
      max-width: 400px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .card-stack-container {
      position: relative;
      width: 100%;
      aspect-ratio: 3/4;
      max-height: 560px;
    }

    .card-stack {
      position: relative;
      width: 100%;
      height: 100%;
    }

    .card {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 24px;
      overflow: hidden;
      cursor: grab;
      touch-action: pan-y;
      transition: transform 0.1s ease-out;
      will-change: transform;
      box-shadow: 0 10px 40px rgba(0,0,0,0.15);
    }

    .card:active {
      cursor: grabbing;
    }

    .card.animating {
      transition: transform 0.4s ease-out, opacity 0.4s ease-out;
    }

    .card-bg {
      position: absolute;
      inset: 0;
      background-size: cover;
      background-position: center;
    }

    .card-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(to top, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.3) 40%, rgba(0,0,0,0.1) 100%);
    }

    .card-content {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 28px;
      color: #fff;
    }

    .card-topic {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: rgba(255,255,255,0.5);
      margin-bottom: 10px;
    }

    .card-headline {
      font-size: 1.5rem;
      font-weight: 600;
      line-height: 1.2;
      margin-bottom: 10px;
      color: #fff;
    }

    .card-subheadline {
      font-size: 14px;
      color: rgba(255,255,255,0.7);
      line-height: 1.5;
    }

    .card-counter {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(0,0,0,0.5);
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      color: rgba(255,255,255,0.7);
      backdrop-filter: blur(10px);
    }

    .swipe-hint {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      opacity: 0;
      pointer-events: none;
      color: #fff;
    }

    .swipe-hint.left {
      left: 20px;
      background: #ff4444;
    }

    .swipe-hint.right {
      right: 20px;
      background: #44cc44;
    }

    /* Stack indicator */
    .stack-indicator {
      display: flex;
      justify-content: center;
      gap: 6px;
      margin-top: 20px;
    }

    .stack-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #ddd;
      transition: all 0.3s;
    }

    .stack-dot.active {
      background: #1a1a1a;
      width: 24px;
      border-radius: 4px;
    }

    .stack-dot.seen {
      background: #bbb;
    }

    .tap-hint {
      text-align: center;
      color: #999;
      font-size: 12px;
      margin-top: 16px;
    }

    /* Empty state */
    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: #bbb;
      text-align: center;
      padding: 40px;
    }

    .empty-state .icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    .empty-state p {
      font-size: 14px;
      line-height: 1.6;
    }

    /* Right Panel - Mini Apps */
    .panel {
      background: #fafafa;
      border-left: 1px solid #eee;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .panel-header {
      padding: 24px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      background: #fff;
    }

    .panel-header-info h2 {
      font-size: 1.1rem;
      margin-bottom: 4px;
      color: #1a1a1a;
    }

    .panel-header-info p {
      font-size: 12px;
      color: #999;
    }

    .panel-close {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      background: #f5f5f5;
      border: none;
      color: #999;
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .panel-close:hover {
      background: #eee;
      color: #666;
    }

    .panel-content {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
    }

    .mini-app {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 14px;
      background: #fff;
      border-radius: 14px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid #eee;
    }

    .mini-app:hover {
      border-color: #ddd;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .mini-app-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      flex-shrink: 0;
    }

    .mini-app-info {
      flex: 1;
      min-width: 0;
    }

    .mini-app-info h4 {
      font-size: 14px;
      margin-bottom: 3px;
      color: #1a1a1a;
    }

    .mini-app-info p {
      font-size: 12px;
      color: #888;
      line-height: 1.4;
    }

    .mini-app-arrow {
      color: #ccc;
      font-size: 16px;
    }

    /* Card prompt in panel */
    .panel .prompt-box {
      margin: 0 0 16px 0;
    }

    /* All done state */
    .done-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: #999;
    }

    .done-state .checkmark {
      font-size: 56px;
      margin-bottom: 16px;
    }

    .done-state p {
      font-size: 15px;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .layout {
        grid-template-columns: 280px 1fr 0px;
      }
      .layout.panel-open {
        grid-template-columns: 280px 1fr 340px;
      }
    }

    @media (max-width: 768px) {
      .layout {
        grid-template-columns: 1fr;
      }
      .layout.panel-open {
        grid-template-columns: 1fr;
      }
      .sidebar {
        display: none;
      }
      .panel {
        position: fixed;
        inset: 0;
        z-index: 100;
        transform: translateX(100%);
        transition: transform 0.3s ease;
      }
      .layout.panel-open .panel {
        transform: translateX(0);
      }
    }
  </style>
</head>
<body>
  <div class="layout" id="layout">
    <!-- Left Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1>For You</h1>
        <button class="prompts-toggle" id="promptsToggle">Prompts</button>
      </div>

      <div class="prompt-box" id="personaPrompt">
        <div class="label">Persona Selection</div>
        <pre>Given the user's profile and memories,
select the most relevant content topics.
Consider personal interests, professional
background, lifestyle values, and recent
activities. Return 5 diverse topics.</pre>
      </div>

      <div class="section-label">Choose Persona</div>
      <div class="persona-list" id="personaList"></div>

      <div class="persona-details" id="personaDetails">
        <div class="section-label">About</div>
        <p class="persona-bio" id="personaBio"></p>

        <div class="section-label">Memories</div>
        <div class="memories" id="personaMemories"></div>

        <div class="prompt-box" id="cardPrompt">
          <div class="label">Card Generation</div>
          <pre>For topic "{topic}" and persona:
Generate headline (5-8 words),
subheadline (15-20 words), and
atmospheric image prompt. Match
tone to persona's sophistication.</pre>
        </div>

        <button class="generate-btn" id="generateBtn">Generate Recommendations</button>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main">
      <div class="card-area">
        <div class="card-stack-container" id="cardStackContainer">
          <div class="card-stack" id="cardStack">
            <div class="empty-state">
              <div class="icon">‚Üê</div>
              <p>Select a persona from the sidebar<br>to generate personalized cards</p>
            </div>
          </div>
        </div>
        <div class="stack-indicator" id="stackIndicator"></div>
        <div class="tap-hint" id="tapHint" style="display: none;">Tap card to explore ‚Ä¢ Swipe to browse</div>
      </div>
    </main>

    <!-- Right Panel -->
    <aside class="panel" id="panel">
      <div class="panel-header">
        <div class="panel-header-info">
          <h2 id="panelTitle">Category</h2>
          <p id="panelSubtitle">Explore mini-apps</p>
        </div>
        <button class="panel-close" id="panelClose">√ó</button>
      </div>
      <div class="panel-content">
        <div class="prompt-box visible" id="miniAppsPrompt">
          <div class="label">Mini-Apps Generation</div>
          <pre>For category "{topic}" and persona:
Generate 4-5 relevant mini-apps with
name, description, icon emoji, and
color. Apps should feel like useful
tools within this category.</pre>
        </div>
        <div id="miniAppsList"></div>
      </div>
    </aside>
  </div>

  <script>
    // Personas with images
    const personas = [
      {
        id: 'creative-professional',
        name: 'Maya',
        role: 'Creative Director',
        avatar: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=200&q=80',
        bio: 'A 34-year-old creative director based in Brooklyn. Passionate about sustainable design, experimental typography, and finding inspiration in urban architecture. Spends weekends exploring galleries and vintage bookstores.',
        memories: ['sustainable design', 'typography', 'urban exploration', 'vintage books', 'gallery visits', 'Brooklyn life', 'brand identity']
      },
      {
        id: 'tech-entrepreneur',
        name: 'Alex',
        role: 'Startup Founder',
        avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=200&q=80',
        bio: 'A 29-year-old tech entrepreneur building their second startup in the AI space. Interested in productivity systems, meditation, and long-distance running. Believes in building tools that amplify human potential.',
        memories: ['AI technology', 'productivity', 'meditation', 'running marathons', 'sci-fi novels', 'startup culture', 'system design']
      },
      {
        id: 'culinary-explorer',
        name: 'Sofia',
        role: 'Food Writer',
        avatar: 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=200&q=80',
        bio: 'A 42-year-old food writer who spent years living in Italy and Japan. Obsessed with fermentation, seasonal cooking, and the stories behind family recipes. Collects vintage cookware.',
        memories: ['Italian cuisine', 'Japanese cooking', 'fermentation', 'seasonal ingredients', 'family recipes', 'vintage cookware', 'food history']
      },
      {
        id: 'outdoor-minimalist',
        name: 'Kai',
        role: 'Nature Photographer',
        avatar: 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=200&q=80',
        bio: 'A 38-year-old nature photographer living in a converted van. Documents wilderness areas and advocates for conservation. Finds peace in solitude and the rhythm of natural light.',
        memories: ['wilderness photography', 'van life', 'conservation', 'minimalism', 'natural light', 'mountain trails', 'wildlife']
      }
    ];

    // Topics and cards by persona
    const topicsByPersona = {
      'creative-professional': [
        { topic: 'Typography', headline: 'The Lost Art of Hand-Lettering', subheadline: 'How Brooklyn sign painters are keeping traditional letterforms alive in the digital age', image: 'https://images.unsplash.com/photo-1455390582262-044cdead277a?w=800&q=80' },
        { topic: 'Sustainable Design', headline: 'Materials That Give Back', subheadline: 'Exploring circular design principles through the work of five innovative studios', image: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&q=80' },
        { topic: 'Architecture', headline: 'Brutalism\'s Quiet Revival', subheadline: 'Why young architects are revisiting concrete poetry in residential spaces', image: 'https://images.unsplash.com/photo-1488972685288-c3fd157d7c7a?w=800&q=80' },
        { topic: 'Creative Process', headline: 'The 4AM Sketchbook', subheadline: 'Inside the morning rituals of designers who swear by pre-dawn creativity', image: 'https://images.unsplash.com/photo-1456735190827-d1262f71b8a3?w=800&q=80' },
        { topic: 'Visual Culture', headline: 'When Bookstores Were Galleries', subheadline: 'A photographic journey through the most beautiful independent bookshops', image: 'https://images.unsplash.com/photo-1507842217343-583bb7270b66?w=800&q=80' }
      ],
      'tech-entrepreneur': [
        { topic: 'AI & Creativity', headline: 'The Co-Pilot Mindset', subheadline: 'How founders are learning to think alongside AI rather than against it', image: 'https://images.unsplash.com/photo-1677442136019-21780ecad995?w=800&q=80' },
        { topic: 'Mindfulness', headline: 'The Silent Morning', subheadline: 'Why top founders are abandoning phones for meditation before 7AM', image: 'https://images.unsplash.com/photo-1506126613408-eca07ce68773?w=800&q=80' },
        { topic: 'Endurance', headline: 'Run to Build', subheadline: 'The unexpected connection between ultramarathons and startup resilience', image: 'https://images.unsplash.com/photo-1552674605-db6ffd4facb5?w=800&q=80' },
        { topic: 'Future Fiction', headline: 'Sci-Fi as Business Strategy', subheadline: 'The novels that predicted today\'s tech‚Äîand what they say about tomorrow', image: 'https://images.unsplash.com/photo-1451187580459-43490279c0fa?w=800&q=80' },
        { topic: 'Systems Thinking', headline: 'The Anti-Productivity System', subheadline: 'Counterintuitive frameworks for getting more done by doing less', image: 'https://images.unsplash.com/photo-1484480974693-6ca0a78fb36b?w=800&q=80' }
      ],
      'culinary-explorer': [
        { topic: 'Fermentation', headline: 'The Patience of Koji', subheadline: 'A 72-hour journey into Japan\'s most transformative ingredient', image: 'https://images.unsplash.com/photo-1563245372-f21724e3856d?w=800&q=80' },
        { topic: 'Italian Heritage', headline: 'Nonnas Never Measured', subheadline: 'Preserving recipes that exist only in muscle memory and love', image: 'https://images.unsplash.com/photo-1556761223-4c4282c73f77?w=800&q=80' },
        { topic: 'Seasonal Cooking', headline: 'The Winter Larder', subheadline: 'Ancient preservation techniques for a modern kitchen', image: 'https://images.unsplash.com/photo-1466637574441-749b8f19452f?w=800&q=80' },
        { topic: 'Food History', headline: 'When Empires Ate', subheadline: 'How trade routes shaped the dishes we now call home cooking', image: 'https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=800&q=80' },
        { topic: 'Kitchen Tools', headline: 'The Pan That Raised Me', subheadline: 'Personal essays on the heirloom cookware we\'ll never replace', image: 'https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=800&q=80' }
      ],
      'outdoor-minimalist': [
        { topic: 'Light & Landscape', headline: 'Chasing Golden Hour', subheadline: 'The photographer\'s obsession with those fleeting moments of perfect light', image: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800&q=80' },
        { topic: 'Conservation', headline: 'The Last Wild Places', subheadline: 'Documenting wilderness before it exists only in photographs', image: 'https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?w=800&q=80' },
        { topic: 'Minimalism', headline: 'Everything I Own Fits Here', subheadline: 'What two years of van life taught me about what actually matters', image: 'https://images.unsplash.com/photo-1523712999610-f77fbcfc3843?w=800&q=80' },
        { topic: 'Solitude', headline: 'The Gift of Being Alone', subheadline: 'Finding yourself in places where no one can find you', image: 'https://images.unsplash.com/photo-1501785888041-af3ef285b470?w=800&q=80' },
        { topic: 'Wildlife', headline: 'Patience as Practice', subheadline: 'The meditation of waiting for wildlife to reveal itself', image: 'https://images.unsplash.com/photo-1474511320723-9a56873571b7?w=800&q=80' }
      ]
    };

    // Mini apps by topic
    const miniAppsByTopic = {
      'Typography': [
        { name: 'Letter Lab', desc: 'Practice hand-lettering with guided stroke exercises', icon: '‚úçÔ∏è', color: '#2D3436' },
        { name: 'Type Pair', desc: 'AI-powered font pairing suggestions for your projects', icon: 'üî§', color: '#6C5CE7' },
        { name: 'Kerning Game', desc: 'Train your eye with interactive spacing challenges', icon: 'üìê', color: '#00B894' },
        { name: 'Font Scanner', desc: 'Identify typefaces from photos instantly', icon: 'üì∑', color: '#E17055' }
      ],
      'Sustainable Design': [
        { name: 'Material Index', desc: 'Browse eco-friendly materials with sourcing info', icon: 'üå±', color: '#00B894' },
        { name: 'Carbon Calc', desc: 'Estimate the environmental impact of design choices', icon: 'üìä', color: '#636E72' },
        { name: 'Circular Studio', desc: 'Design products with end-of-life in mind', icon: '‚ôªÔ∏è', color: '#74B9FF' },
        { name: 'Green Suppliers', desc: 'Directory of sustainable manufacturers', icon: 'üè≠', color: '#55A3A2' }
      ],
      'Architecture': [
        { name: 'Brutalist Map', desc: 'Discover concrete masterpieces near you', icon: 'üó∫Ô∏è', color: '#636E72' },
        { name: 'Structure Scan', desc: 'AR overlay showing building construction methods', icon: 'üì±', color: '#2D3436' },
        { name: 'Space Sketch', desc: 'Quick architectural concept drawings', icon: '‚úèÔ∏è', color: '#B2BEC3' },
        { name: 'Light Study', desc: 'Simulate natural light in any space', icon: '‚òÄÔ∏è', color: '#FDCB6E' }
      ],
      'Creative Process': [
        { name: 'Morning Pages', desc: 'Guided journaling for creative breakthroughs', icon: 'üìì', color: '#E17055' },
        { name: 'Idea Shuffle', desc: 'Random prompts to spark unexpected connections', icon: 'üé≤', color: '#A29BFE' },
        { name: 'Focus Timer', desc: 'Pomodoro with ambient sounds for deep work', icon: '‚è±Ô∏è', color: '#00CEC9' },
        { name: 'Mood Board', desc: 'Collect and arrange visual inspiration', icon: 'üé®', color: '#FD79A8' }
      ],
      'Visual Culture': [
        { name: 'Gallery Walk', desc: 'Virtual tours of independent bookshops worldwide', icon: 'üö∂', color: '#6C5CE7' },
        { name: 'Cover Archive', desc: 'Browse 50 years of iconic book cover design', icon: 'üìö', color: '#E84393' },
        { name: 'Print Spotter', desc: 'Identify printing techniques in publications', icon: 'üîç', color: '#2D3436' },
        { name: 'Zine Maker', desc: 'Create and print your own mini publications', icon: 'üì∞', color: '#00B894' }
      ],
      'AI & Creativity': [
        { name: 'Prompt Lab', desc: 'Experiment with AI prompting techniques', icon: 'üß™', color: '#6C5CE7' },
        { name: 'AI Audit', desc: 'Understand how AI makes decisions in your tools', icon: 'üîç', color: '#636E72' },
        { name: 'Co-Create', desc: 'Real-time collaborative writing with AI', icon: 'ü§ù', color: '#00CEC9' },
        { name: 'Future Scan', desc: 'AI predictions for your industry', icon: 'üîÆ', color: '#A29BFE' }
      ],
      'Mindfulness': [
        { name: 'Silent Start', desc: 'Phone-free morning routine tracker', icon: 'üåÖ', color: '#FDCB6E' },
        { name: 'Breath Box', desc: 'Simple breathing exercises for focus', icon: 'ü´Å', color: '#74B9FF' },
        { name: 'Mind Map', desc: 'Visualize your mental state over time', icon: 'üß†', color: '#FD79A8' },
        { name: 'Zen Space', desc: 'Ambient soundscapes for meditation', icon: 'üéµ', color: '#55A3A2' }
      ],
      'Endurance': [
        { name: 'Trail Finder', desc: 'Discover running routes by terrain and distance', icon: 'üèÉ', color: '#E17055' },
        { name: 'Pace Coach', desc: 'AI-powered training plans for your goals', icon: 'üìà', color: '#00B894' },
        { name: 'Recovery Log', desc: 'Track sleep, nutrition, and rest days', icon: 'üò¥', color: '#74B9FF' },
        { name: 'Mental Miles', desc: 'Visualization exercises for race day', icon: 'üßò', color: '#A29BFE' }
      ],
      'Future Fiction': [
        { name: 'Sci-Fi Stack', desc: 'Personalized reading recommendations', icon: 'üìö', color: '#2D3436' },
        { name: 'World Builder', desc: 'Create and explore fictional universes', icon: 'üåç', color: '#6C5CE7' },
        { name: 'Tech Timeline', desc: 'When fiction predicted reality', icon: '‚è≥', color: '#636E72' },
        { name: 'Story Spark', desc: 'AI-generated sci-fi writing prompts', icon: '‚ú®', color: '#FD79A8' }
      ],
      'Systems Thinking': [
        { name: 'Flow Chart', desc: 'Map complex systems visually', icon: 'üîÄ', color: '#636E72' },
        { name: 'Habit Stack', desc: 'Build routines that compound', icon: 'üìä', color: '#00B894' },
        { name: 'Decision Tree', desc: 'Structured frameworks for tough choices', icon: 'üå≥', color: '#55A3A2' },
        { name: 'Time Audit', desc: 'Understand where your hours actually go', icon: '‚è∞', color: '#E17055' }
      ],
      'Fermentation': [
        { name: 'Ferment Timer', desc: 'Track your cultures with smart reminders', icon: '‚è±Ô∏è', color: '#B2BEC3' },
        { name: 'Koji Guide', desc: 'Step-by-step instructions for growing koji', icon: 'üçö', color: '#DFE6E9' },
        { name: 'Flavor Map', desc: 'Understand umami development over time', icon: 'üëÖ', color: '#E17055' },
        { name: 'Starter Swap', desc: 'Trade cultures with local fermenters', icon: 'üîÑ', color: '#00B894' }
      ],
      'Italian Heritage': [
        { name: 'Nonna\'s Voice', desc: 'Record and transcribe family recipes', icon: 'üéôÔ∏è', color: '#E17055' },
        { name: 'Pasta Shapes', desc: 'Match pasta to sauce like an Italian', icon: 'üçù', color: '#FDCB6E' },
        { name: 'Region Dive', desc: 'Explore cuisine by Italian province', icon: 'üó∫Ô∏è', color: '#00B894' },
        { name: 'Sunday Table', desc: 'Plan authentic multi-course meals', icon: 'üçΩÔ∏è', color: '#B2BEC3' }
      ],
      'Seasonal Cooking': [
        { name: 'Harvest Cal', desc: 'What\'s fresh and local right now', icon: 'üìÖ', color: '#00B894' },
        { name: 'Preserve It', desc: 'Guides for canning, pickling, and drying', icon: 'ü´ô', color: '#FDCB6E' },
        { name: 'Root Cellar', desc: 'Storage tips for seasonal abundance', icon: 'ü•ï', color: '#E17055' },
        { name: 'Frost Date', desc: 'Plan your garden and preservation calendar', icon: '‚ùÑÔ∏è', color: '#74B9FF' }
      ],
      'Food History': [
        { name: 'Spice Routes', desc: 'Interactive map of culinary trade history', icon: 'üå∂Ô∏è', color: '#E17055' },
        { name: 'Time Table', desc: 'Explore historical menus and meals', icon: 'üìú', color: '#B2BEC3' },
        { name: 'Origin Story', desc: 'The surprising history of everyday dishes', icon: 'üîç', color: '#6C5CE7' },
        { name: 'Empire Eats', desc: 'How colonialism shaped global cuisine', icon: 'üåç', color: '#636E72' }
      ],
      'Kitchen Tools': [
        { name: 'Tool Tales', desc: 'Share stories about your heirloom cookware', icon: 'üç≥', color: '#B2BEC3' },
        { name: 'Vintage Find', desc: 'Identify and value antique kitchen items', icon: 'üîé', color: '#FDCB6E' },
        { name: 'Care Guide', desc: 'Maintain cast iron, copper, and carbon steel', icon: '‚ú®', color: '#636E72' },
        { name: 'Maker Map', desc: 'Find artisan cookware craftspeople', icon: 'üó∫Ô∏è', color: '#00B894' }
      ],
      'Light & Landscape': [
        { name: 'Golden Hour', desc: 'Precise light timing for any location', icon: 'üåÖ', color: '#FDCB6E' },
        { name: 'Weather Eye', desc: 'Predict dramatic skies and conditions', icon: '‚õÖ', color: '#74B9FF' },
        { name: 'Comp Guide', desc: 'Composition overlays for your camera', icon: 'üì∑', color: '#2D3436' },
        { name: 'Light Journal', desc: 'Log conditions for repeat visits', icon: 'üìì', color: '#E17055' }
      ],
      'Conservation': [
        { name: 'Wild Watch', desc: 'Report and track wildlife sightings', icon: 'ü¶å', color: '#00B894' },
        { name: 'Trail Guard', desc: 'Document trail conditions and issues', icon: 'ü•æ', color: '#B2BEC3' },
        { name: 'Impact Calc', desc: 'Measure your outdoor footprint', icon: 'üë£', color: '#636E72' },
        { name: 'Action Hub', desc: 'Local conservation volunteer opportunities', icon: 'ü§ù', color: '#55A3A2' }
      ],
      'Minimalism': [
        { name: 'Own Less', desc: 'Guided decluttering by category', icon: 'üì¶', color: '#B2BEC3' },
        { name: 'Van Config', desc: 'Space planning for mobile living', icon: 'üöê', color: '#636E72' },
        { name: 'Essentials', desc: 'Curated lists of quality basics', icon: '‚úì', color: '#2D3436' },
        { name: 'Cost Per Use', desc: 'Track the real value of what you own', icon: 'üí∞', color: '#00B894' }
      ],
      'Solitude': [
        { name: 'Quiet Finder', desc: 'Discover secluded spots near you', icon: 'üèîÔ∏è', color: '#74B9FF' },
        { name: 'Solo Journal', desc: 'Reflection prompts for time alone', icon: 'üìù', color: '#B2BEC3' },
        { name: 'Silence Map', desc: 'Noise pollution data for trip planning', icon: 'üîá', color: '#636E72' },
        { name: 'Inner Voice', desc: 'Guided self-discovery exercises', icon: 'üßò', color: '#A29BFE' }
      ],
      'Wildlife': [
        { name: 'Track ID', desc: 'Identify animal signs and tracks', icon: 'üêæ', color: '#B2BEC3' },
        { name: 'Wait Spot', desc: 'Community-sourced wildlife viewing locations', icon: 'üëÄ', color: '#00B894' },
        { name: 'Call Library', desc: 'Learn and identify animal vocalizations', icon: 'üîä', color: '#6C5CE7' },
        { name: 'Behavior Log', desc: 'Document wildlife patterns and habits', icon: 'üìä', color: '#E17055' }
      ]
    };

    let selectedPersona = null;
    let currentCardIndex = 0;
    let cards = [];
    let showPrompts = false;
    let panelOpen = false;

    // Initialize
    function init() {
      initPersonaList();

      document.getElementById('generateBtn').onclick = generateCards;
      document.getElementById('promptsToggle').onclick = togglePrompts;
      document.getElementById('panelClose').onclick = closePanel;
    }

    function initPersonaList() {
      const list = document.getElementById('personaList');
      personas.forEach(persona => {
        const btn = document.createElement('button');
        btn.className = 'persona-btn';
        btn.innerHTML = `
          <img class="persona-avatar" src="${persona.avatar}" alt="${persona.name}">
          <div class="persona-btn-info">
            <div class="name">${persona.name}</div>
            <div class="role">${persona.role}</div>
          </div>
        `;
        btn.onclick = () => selectPersona(persona);
        list.appendChild(btn);
      });
    }

    function selectPersona(persona) {
      selectedPersona = persona;
      currentCardIndex = 0;
      closePanel();

      // Update button states
      document.querySelectorAll('.persona-btn').forEach((btn, i) => {
        btn.classList.toggle('active', personas[i].id === persona.id);
      });

      // Show persona details
      document.getElementById('personaDetails').classList.add('visible');
      document.getElementById('personaBio').textContent = persona.bio;

      const memoriesEl = document.getElementById('personaMemories');
      memoriesEl.innerHTML = persona.memories.map(m => `<span class="memory-tag">${m}</span>`).join('');

      // Reset card stack
      document.getElementById('cardStack').innerHTML = `
        <div class="empty-state">
          <div class="icon">‚Üì</div>
          <p>Click "Generate Recommendations"<br>to create personalized cards</p>
        </div>
      `;
      document.getElementById('stackIndicator').innerHTML = '';
      document.getElementById('tapHint').style.display = 'none';
    }

    function togglePrompts() {
      showPrompts = !showPrompts;
      document.getElementById('promptsToggle').classList.toggle('active', showPrompts);

      document.querySelectorAll('.prompt-box').forEach(box => {
        box.classList.toggle('visible', showPrompts);
      });
    }

    function generateCards() {
      if (!selectedPersona) return;

      cards = topicsByPersona[selectedPersona.id];
      currentCardIndex = 0;

      document.getElementById('tapHint').style.display = 'block';
      renderCardStack();

      // Open panel with first card
      openPanel(cards[0]);
    }

    function renderCardStack() {
      const stack = document.getElementById('cardStack');
      stack.innerHTML = '';

      if (currentCardIndex >= cards.length) {
        stack.innerHTML = `
          <div class="done-state">
            <div class="checkmark">‚úì</div>
            <p>All caught up!</p>
          </div>
        `;
        document.getElementById('stackIndicator').innerHTML = '';
        document.getElementById('tapHint').style.display = 'none';
        closePanel();
        return;
      }

      // Render cards in reverse order (last card at bottom)
      const visibleCards = cards.slice(currentCardIndex, currentCardIndex + 3);

      visibleCards.reverse().forEach((card, reverseIndex) => {
        const actualIndex = visibleCards.length - 1 - reverseIndex;
        const cardEl = createCardElement(card, currentCardIndex + actualIndex);

        // Stack offset
        const offset = actualIndex * 8;
        const scale = 1 - (actualIndex * 0.03);
        cardEl.style.transform = `translateY(${offset}px) scale(${scale})`;
        cardEl.style.zIndex = visibleCards.length - actualIndex;

        if (actualIndex === 0) {
          enableSwipe(cardEl);
        }

        stack.appendChild(cardEl);
      });

      renderStackIndicator();

      // Update panel with current card if panel is open
      if (panelOpen && cards[currentCardIndex]) {
        updatePanel(cards[currentCardIndex]);
      }
    }

    function createCardElement(card, index) {
      const cardEl = document.createElement('div');
      cardEl.className = 'card';
      cardEl.innerHTML = `
        <div class="card-bg" style="background-image: url('${card.image}')"></div>
        <div class="card-overlay"></div>
        <div class="card-content">
          <div class="card-topic">${card.topic}</div>
          <div class="card-headline">${card.headline}</div>
          <div class="card-subheadline">${card.subheadline}</div>
        </div>
        <div class="card-counter">${index + 1} / ${cards.length}</div>
        <div class="swipe-hint left">SKIP</div>
        <div class="swipe-hint right">SAVE</div>
      `;

      cardEl.addEventListener('click', (e) => {
        if (!cardEl.classList.contains('dragging')) {
          openPanel(card);
        }
      });

      return cardEl;
    }

    function enableSwipe(cardEl) {
      let startX = 0;
      let currentX = 0;
      let isDragging = false;

      const onStart = (e) => {
        isDragging = true;
        cardEl.classList.add('dragging');
        startX = e.type === 'mousedown' ? e.clientX : e.touches[0].clientX;
      };

      const onMove = (e) => {
        if (!isDragging) return;

        const x = e.type === 'mousemove' ? e.clientX : e.touches[0].clientX;
        currentX = x - startX;

        const rotation = currentX * 0.05;
        cardEl.style.transform = `translateX(${currentX}px) rotate(${rotation}deg)`;

        // Show hints
        const leftHint = cardEl.querySelector('.swipe-hint.left');
        const rightHint = cardEl.querySelector('.swipe-hint.right');

        leftHint.style.opacity = currentX < -50 ? Math.min(1, Math.abs(currentX + 50) / 100) : 0;
        rightHint.style.opacity = currentX > 50 ? Math.min(1, (currentX - 50) / 100) : 0;
      };

      const onEnd = () => {
        if (!isDragging) return;
        isDragging = false;

        setTimeout(() => {
          cardEl.classList.remove('dragging');
        }, 100);

        const threshold = 100;

        if (Math.abs(currentX) > threshold) {
          // Swipe away
          cardEl.classList.add('animating');
          const direction = currentX > 0 ? 1 : -1;
          cardEl.style.transform = `translateX(${direction * 500}px) rotate(${direction * 30}deg)`;
          cardEl.style.opacity = '0';

          setTimeout(() => {
            currentCardIndex++;
            renderCardStack();
          }, 300);
        } else {
          // Snap back
          cardEl.classList.add('animating');
          cardEl.style.transform = 'translateX(0) rotate(0)';
          cardEl.querySelector('.swipe-hint.left').style.opacity = 0;
          cardEl.querySelector('.swipe-hint.right').style.opacity = 0;

          setTimeout(() => {
            cardEl.classList.remove('animating');
          }, 300);
        }

        currentX = 0;
      };

      cardEl.addEventListener('mousedown', onStart);
      cardEl.addEventListener('touchstart', onStart, { passive: true });

      document.addEventListener('mousemove', onMove);
      document.addEventListener('touchmove', onMove, { passive: true });

      document.addEventListener('mouseup', onEnd);
      document.addEventListener('touchend', onEnd);
    }

    function renderStackIndicator() {
      const indicator = document.getElementById('stackIndicator');
      indicator.innerHTML = cards.map((_, i) => {
        let className = 'stack-dot';
        if (i === currentCardIndex) className += ' active';
        else if (i < currentCardIndex) className += ' seen';
        return `<div class="${className}"></div>`;
      }).join('');
    }

    function openPanel(card) {
      panelOpen = true;
      updatePanel(card);
      document.getElementById('layout').classList.add('panel-open');
    }

    function updatePanel(card) {
      const apps = miniAppsByTopic[card.topic] || [];

      document.getElementById('panelTitle').textContent = card.topic;
      document.getElementById('panelSubtitle').textContent = `${apps.length} mini-apps to explore`;

      const list = document.getElementById('miniAppsList');
      list.innerHTML = apps.map(app => `
        <div class="mini-app">
          <div class="mini-app-icon" style="background: ${app.color}">${app.icon}</div>
          <div class="mini-app-info">
            <h4>${app.name}</h4>
            <p>${app.desc}</p>
          </div>
          <div class="mini-app-arrow">‚Üí</div>
        </div>
      `).join('');
    }

    function closePanel() {
      panelOpen = false;
      document.getElementById('layout').classList.remove('panel-open');
    }

    init();
  </script>
</body>
</html>
