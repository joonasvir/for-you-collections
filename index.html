<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>For You Collections</title>
  <style>
    @font-face {
      font-family: 'Selecta';
      src: url('/fonts/Selecta/Selecta-Thin.otf') format('opentype');
      font-weight: 100;
      font-style: normal;
    }
    @font-face {
      font-family: 'Selecta';
      src: url('/fonts/Selecta/Selecta-ThinItalic.otf') format('opentype');
      font-weight: 100;
      font-style: italic;
    }
    @font-face {
      font-family: 'Selecta';
      src: url('/fonts/Selecta/Selecta-Light.otf') format('opentype');
      font-weight: 300;
      font-style: normal;
    }
    @font-face {
      font-family: 'Selecta';
      src: url('/fonts/Selecta/Selecta-LightItalic.otf') format('opentype');
      font-weight: 300;
      font-style: italic;
    }
    @font-face {
      font-family: 'Selecta';
      src: url('/fonts/Selecta/Selecta-Regular.otf') format('opentype');
      font-weight: 400;
      font-style: normal;
    }
    @font-face {
      font-family: 'Selecta';
      src: url('/fonts/Selecta/Selecta-Italic.otf') format('opentype');
      font-weight: 400;
      font-style: italic;
    }
    @font-face {
      font-family: 'Selecta';
      src: url('/fonts/Selecta/Selecta-Medium.otf') format('opentype');
      font-weight: 500;
      font-style: normal;
    }
    @font-face {
      font-family: 'Selecta';
      src: url('/fonts/Selecta/Selecta-MediumItalic.otf') format('opentype');
      font-weight: 500;
      font-style: italic;
    }
    @font-face {
      font-family: 'Selecta';
      src: url('/fonts/Selecta/Selecta-Bold.otf') format('opentype');
      font-weight: 700;
      font-style: normal;
    }
    @font-face {
      font-family: 'Selecta';
      src: url('/fonts/Selecta/Selecta-BoldItalic.otf') format('opentype');
      font-weight: 700;
      font-style: italic;
    }
    @font-face {
      font-family: 'Selecta';
      src: url('/fonts/Selecta/Selecta-Black.otf') format('opentype');
      font-weight: 900;
      font-style: normal;
    }
    @font-face {
      font-family: 'Selecta';
      src: url('/fonts/Selecta/Selecta-BlackItalic.otf') format('opentype');
      font-weight: 900;
      font-style: italic;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Selecta', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #ffffff;
      color: #1a1a1a;
      min-height: 100vh;
      overflow: hidden;
    }

    /* Two Column Layout */
    .layout {
      display: grid;
      grid-template-columns: 340px 1fr;
      height: 100vh;
    }

    /* Left Sidebar */
    .sidebar {
      background: #ffffff;
      border-right: 1px solid #eee;
      padding: 24px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    .sidebar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .sidebar h1 {
      font-size: 1.25rem;
      font-weight: 600;
      color: #1a1a1a;
    }

    /* Contextual prompt buttons */
    .prompt-toggle-btn {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: transparent;
      border: 1px solid #ddd;
      color: #aaa;
      font-size: 11px;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-left: 8px;
      flex-shrink: 0;
    }

    .prompt-toggle-btn:hover {
      border-color: #999;
      color: #666;
      background: #f5f5f5;
    }

    .prompt-toggle-btn.active {
      background: #1a1a1a;
      border-color: #1a1a1a;
      color: #fff;
    }

    .section-header {
      display: flex;
      align-items: center;
      margin-bottom: 12px;
    }

    .section-header .section-label {
      margin-bottom: 0;
    }

    .section-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: #999;
      margin-bottom: 12px;
    }

    /* Persona Filters */
    .filter-tabs {
      display: flex;
      gap: 4px;
      margin-bottom: 16px;
      background: #f0f0f0;
      padding: 4px;
      border-radius: 10px;
    }

    .filter-tab {
      flex: 1;
      padding: 8px 12px;
      background: transparent;
      border: none;
      border-radius: 8px;
      font-size: 12px;
      color: #888;
      cursor: pointer;
      transition: all 0.2s;
    }

    .filter-tab:hover {
      color: #666;
    }

    .filter-tab.active {
      background: #fff;
      color: #1a1a1a;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    /* Persona Selector */
    .persona-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 24px;
      max-height: 280px;
      overflow-y: auto;
    }

    .persona-btn {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 12px;
      background: transparent;
      border: 1px solid transparent;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: left;
    }

    .persona-btn:hover {
      background: #f5f5f5;
    }

    .persona-btn.active {
      background: #f0f0f0;
      border-color: #e0e0e0;
    }

    .persona-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #eee;
      flex-shrink: 0;
    }

    .persona-btn.active .persona-avatar {
      border-color: #1a1a1a;
    }

    .persona-btn-info {
      flex: 1;
      min-width: 0;
    }

    .persona-btn .name {
      font-size: 13px;
      font-weight: 500;
      color: #666;
      margin-bottom: 1px;
    }

    .persona-btn.active .name {
      color: #1a1a1a;
    }

    .persona-btn .role {
      font-size: 11px;
      color: #999;
    }

    .persona-badge {
      font-size: 9px;
      padding: 2px 6px;
      background: #e8e8e8;
      border-radius: 4px;
      color: #888;
      margin-left: auto;
    }

    /* Prompt Box */
    .prompt-box {
      background: #f5f5f5;
      border: 1px solid #eee;
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 20px;
      display: none;
    }

    .prompt-box.visible {
      display: block;
    }

    .prompt-box .label {
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #999;
      margin-bottom: 8px;
    }

    .prompt-box pre {
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 10px;
      color: #666;
      white-space: pre-wrap;
      line-height: 1.5;
    }

    /* Persona Details */
    .persona-details {
      flex: 1;
      display: none;
      flex-direction: column;
    }

    .persona-details.visible {
      display: flex;
    }

    .persona-bio {
      color: #666;
      line-height: 1.6;
      font-size: 13px;
      margin-bottom: 16px;
    }

    .memories {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin-bottom: 20px;
    }

    .memory-tag {
      background: #fff;
      border: 1px solid #e5e5e5;
      padding: 5px 9px;
      border-radius: 12px;
      font-size: 10px;
      color: #666;
    }

    .generate-btn {
      padding: 14px 24px;
      background: #1a1a1a;
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s;
      margin-top: auto;
    }

    .generate-btn:hover {
      background: #333;
    }

    .generate-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    /* Main Content - Card Stack */
    .main {
      display: flex;
      flex-direction: column;
      background: #f5f5f5;
      position: relative;
      overflow: hidden;
    }

    /* Top panel for selectors */
    .top-panel {
      position: sticky;
      top: 0;
      z-index: 100;
      background: #ffffff;
      padding: 16px 24px;
      display: flex;
      flex-direction: row;
      align-items: flex-start;
      justify-content: space-between;
      gap: 12px;
      border-bottom: 1px solid #e8e8e8;
    }

    .style-selector-wrapper {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 8px;
    }

    .style-btn-group {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .style-prompt-toggle {
      display: none;
    }

    .style-prompt-btn {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: transparent;
      border: 1px solid #ddd;
      color: #bbb;
      font-size: 10px;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .style-prompt-btn:hover {
      border-color: #999;
      color: #666;
      background: #f5f5f5;
    }

    .style-prompt-btn.active {
      background: #1a1a1a;
      border-color: #1a1a1a;
      color: #fff;
    }

    .style-prompt-btn:hover {
      border-color: #999;
      color: #666;
      background: #f5f5f5;
    }

    .style-prompt-btn.active {
      background: #1a1a1a;
      border-color: #1a1a1a;
      color: #fff;
    }

    .style-prompt-box {
      display: none;
      background: #f8f8f8;
      border: 1px solid #e5e5e5;
      border-radius: 8px;
      padding: 10px 12px;
      margin-top: 4px;
      max-width: 320px;
    }

    .style-prompt-box.visible {
      display: block;
    }

    .style-prompt-box .prompt-label {
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #999;
      margin-bottom: 6px;
    }

    .style-prompt-box .prompt-text {
      font-size: 11px;
      color: #555;
      line-height: 1.5;
    }

    .card-area {
      flex: 1;
      width: 100%;
      max-width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px;
      justify-content: center;
    }

    /* Model toggle */
    .model-toggle {
      display: flex;
      gap: 4px;
      justify-content: center;
      background: #e8e8e8;
      padding: 4px;
      border-radius: 50px;
      width: fit-content;
    }

    .model-toggle .model-btn {
      padding: 6px 14px;
      background: transparent;
      border: none;
      border-radius: 50px;
      font-size: 12px;
      color: #888;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .model-toggle .model-btn:hover {
      color: #666;
    }

    .model-toggle .model-btn.active {
      background: #fff;
      color: #1a1a1a;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .model-toggle .model-btn .model-icon {
      font-size: 14px;
    }

    /* Style selector */
    .style-selector-main {
      display: flex;
      gap: 6px;
      justify-content: center;
      flex-wrap: nowrap;
    }

    .style-selector-main .style-btn {
      padding: 8px 14px;
      background: #fff;
      border: 1px solid #e5e5e5;
      border-radius: 50px;
      font-size: 13px;
      color: #666;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      white-space: nowrap;
    }

    .style-selector-main .style-btn:hover {
      border-color: #ccc;
      background: #fafafa;
    }

    .style-selector-main .style-btn.active {
      border-color: #1a1a1a;
      color: #1a1a1a;
      background: #fff;
      box-shadow: 0 2px 12px rgba(0,0,0,0.1);
    }

    .style-selector-main .style-btn .icon {
      font-size: 14px;
    }

    .card-stack-container {
      position: relative;
      width: 100%;
      max-width: 100%;
      overflow: hidden;
      min-height: 420px;
    }

    /* Fade mask for carousel edges */
    .card-stack-container::before,
    .card-stack-container::after {
      content: '';
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100px;
      z-index: 10;
      pointer-events: none;
    }

    .card-stack-container::before {
      left: 0;
      background: linear-gradient(to right, #f5f5f5 0%, transparent 100%);
    }

    .card-stack-container::after {
      right: 0;
      background: linear-gradient(to left, #f5f5f5 0%, transparent 100%);
    }

    .card-stack {
      display: flex;
      gap: 20px;
      padding: 20px 50%;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      scroll-behavior: smooth;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }

    .card-stack::-webkit-scrollbar {
      display: none;
    }

    .card {
      flex: 0 0 280px;
      height: 380px;
      border-radius: 24px;
      overflow: hidden;
      cursor: pointer;
      will-change: transform, opacity;
      box-shadow: 0 10px 40px rgba(0,0,0,0.15);
      scroll-snap-align: center;
      transition: transform 0.3s ease, opacity 0.3s ease, box-shadow 0.3s ease;
      position: relative;
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 16px 48px rgba(0,0,0,0.2);
    }

    .card.active {
      box-shadow: 0 20px 60px rgba(0,0,0,0.25);
    }

    .card-bg {
      position: absolute;
      inset: 0;
      background-size: cover;
      background-position: center;
    }

    .card-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(to top, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.3) 40%, rgba(0,0,0,0.1) 100%);
    }

    .card-content {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 28px;
      color: #fff;
    }

    .card-topic {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: rgba(255,255,255,0.5);
      margin-bottom: 10px;
    }

    .card-headline {
      font-size: 1.05rem;
      font-weight: 600;
      line-height: 1.3;
      margin-bottom: 8px;
      color: #fff;
    }

    .card-subheadline {
      font-size: 14px;
      color: rgba(255,255,255,0.7);
      line-height: 1.5;
    }

    .card-counter {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(0,0,0,0.5);
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      color: rgba(255,255,255,0.7);
      backdrop-filter: blur(10px);
    }

    .card-style-badge {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(255,255,255,0.9);
      padding: 6px 10px;
      border-radius: 20px;
      font-size: 10px;
      color: #333;
      backdrop-filter: blur(10px);
    }

    .card-no-image {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: rgba(255,255,255,0.4);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .card-loading {
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      color: #999;
    }

    .card-loading-spinner {
      font-size: 28px;
      animation: spin 1s linear infinite;
      margin-bottom: 12px;
    }

    .card-loading-text {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }


    /* Stack indicator */
    .stack-indicator {
      display: flex;
      justify-content: center;
      gap: 6px;
      margin-top: 20px;
    }

    .stack-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #ddd;
      transition: all 0.3s;
    }

    .stack-dot.active {
      background: #1a1a1a;
      width: 24px;
      border-radius: 4px;
    }

    .stack-dot.seen {
      background: #bbb;
    }

    .tap-hint {
      text-align: center;
      color: #999;
      font-size: 12px;
      margin-top: 16px;
    }

    /* Empty state */
    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 380px;
      width: 100%;
      color: #bbb;
      text-align: center;
      padding: 40px;
    }

    .empty-state .icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    .empty-state p {
      font-size: 14px;
      line-height: 1.6;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    /* Inline Mini Apps Section (below cards) */
    .mini-apps-section {
      display: none;
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      margin-top: 20px;
    }

    .mini-apps-section.visible {
      display: block;
    }

    .mini-apps-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .mini-apps-header h3 {
      font-size: 14px;
      font-weight: 600;
      color: #1a1a1a;
    }

    .mini-apps-header span {
      font-size: 12px;
      color: #999;
    }

    .mini-apps-close {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: #f5f5f5;
      border: none;
      color: #999;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .mini-apps-close:hover {
      background: #eee;
      color: #666;
    }

    .mini-apps-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 12px;
    }

    .mini-app {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: #fafafa;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid #eee;
    }

    .mini-app:hover {
      border-color: #ddd;
      background: #f5f5f5;
    }

    .mini-app-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      flex-shrink: 0;
    }

    .mini-app-info {
      flex: 1;
      min-width: 0;
    }

    .mini-app-info h4 {
      font-size: 14px;
      margin-bottom: 3px;
      color: #1a1a1a;
    }

    .mini-app-info p {
      font-size: 12px;
      color: #888;
      line-height: 1.4;
    }

    .mini-app-arrow {
      color: #ccc;
      font-size: 16px;
    }

    .panel .prompt-box {
      margin: 0 0 16px 0;
    }

    .done-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: #999;
    }

    .done-state .checkmark {
      font-size: 56px;
      margin-bottom: 16px;
    }

    .done-state p {
      font-size: 15px;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .layout {
        grid-template-columns: 300px 1fr 0px;
      }
      .layout.panel-open {
        grid-template-columns: 300px 1fr 340px;
      }
    }

    /* Bottom Panel for Prompt Editing */
    .bottom-panel {
      position: fixed;
      bottom: 0;
      left: 340px;
      right: 0;
      background: #ffffff;
      border-top: 1px solid #e8e8e8;
      padding: 12px 24px;
      z-index: 100;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .bottom-panel-inner {
      width: 100%;
      max-width: 600px;
    }

    .bottom-panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .bottom-panel-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: #999;
    }

    .bottom-panel-pills {
      display: flex;
      gap: 6px;
      justify-content: center;
    }

    /* Prompt Editor Modal */
    .prompt-modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 200;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(4px);
    }

    .prompt-modal-overlay.visible {
      display: flex;
    }

    .prompt-modal {
      background: #fff;
      border-radius: 16px;
      padding: 24px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    .prompt-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .prompt-modal-title {
      font-size: 16px;
      font-weight: 600;
      color: #1a1a1a;
    }

    .prompt-modal-close {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #f5f5f5;
      border: none;
      color: #666;
      font-size: 18px;
      cursor: pointer;
    }

    .prompt-modal-close:hover {
      background: #eee;
    }

    .prompt-modal textarea {
      width: 100%;
      min-height: 120px;
      padding: 12px;
      border: 1px solid #e5e5e5;
      border-radius: 8px;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 13px;
      line-height: 1.5;
      color: #333;
      resize: vertical;
      margin-bottom: 16px;
    }

    .prompt-modal textarea:focus {
      outline: none;
      border-color: #1a1a1a;
    }

    .prompt-modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }

    .prompt-modal-btn {
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .prompt-modal-btn.reset {
      background: transparent;
      border: 1px solid #ddd;
      color: #666;
    }

    .prompt-modal-btn.reset:hover {
      border-color: #999;
    }

    .prompt-modal-btn.save {
      background: #1a1a1a;
      border: 1px solid #1a1a1a;
      color: #fff;
    }

    .prompt-modal-btn.save:hover {
      background: #333;
    }

    /* Success Toast */
    .success-toast {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(-100px);
      background: #22c55e;
      color: #fff;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      z-index: 300;
      transition: transform 0.3s ease;
      box-shadow: 0 4px 20px rgba(34, 197, 94, 0.3);
    }

    .success-toast.visible {
      transform: translateX(-50%) translateY(0);
    }

    .prompt-pill {
      padding: 6px 12px;
      background: #f5f5f5;
      border: 1px solid #e5e5e5;
      border-radius: 20px;
      font-size: 12px;
      color: #666;
      cursor: pointer;
      transition: all 0.2s;
    }

    .prompt-pill:hover {
      border-color: #ccc;
      background: #f0f0f0;
    }

    .prompt-pill.active {
      background: #1a1a1a;
      border-color: #1a1a1a;
      color: #fff;
    }

    .prompt-editor {
      display: none;
      margin-top: 12px;
    }

    .prompt-editor.visible {
      display: block;
    }

    .prompt-editor-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #999;
      margin-bottom: 8px;
    }

    .prompt-editor textarea {
      width: 100%;
      min-height: 60px;
      padding: 12px;
      border: 1px solid #e5e5e5;
      border-radius: 8px;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 12px;
      line-height: 1.5;
      color: #333;
      resize: vertical;
      transition: border-color 0.2s;
    }

    .prompt-editor textarea:focus {
      outline: none;
      border-color: #1a1a1a;
    }

    .prompt-editor-actions {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 8px;
    }

    .prompt-editor-btn {
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 11px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .prompt-editor-btn.reset {
      background: transparent;
      border: 1px solid #ddd;
      color: #888;
    }

    .prompt-editor-btn.reset:hover {
      border-color: #999;
      color: #666;
    }

    .prompt-editor-btn.save {
      background: #1a1a1a;
      border: 1px solid #1a1a1a;
      color: #fff;
    }

    .prompt-editor-btn.save:hover {
      background: #333;
    }

    .prompt-saved-indicator {
      font-size: 10px;
      color: #22c55e;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .prompt-saved-indicator.visible {
      opacity: 1;
    }

    @media (max-width: 768px) {
      .layout {
        grid-template-columns: 1fr;
      }
      .layout.panel-open {
        grid-template-columns: 1fr;
      }
      .sidebar {
        display: none;
      }
      .panel {
        position: fixed;
        inset: 0;
        z-index: 100;
        transform: translateX(100%);
        transition: transform 0.3s ease;
      }
      .layout.panel-open .panel {
        transform: translateX(0);
      }
      .bottom-panel {
        left: 0;
      }
    }
  </style>
</head>
<body>
  <div class="layout" id="layout">
    <!-- Left Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1>For You</h1>
      </div>

      <div class="section-header">
        <span class="section-label">Persona Type</span>
        <button class="prompt-toggle-btn" data-prompt="personaPrompt" title="Show prompt">‚ú¶</button>
      </div>
      <div class="prompt-box" id="personaPrompt">
        <div class="label">Persona Selection Prompt</div>
        <pre>Given the user's profile and memories,
select the most relevant content topics.
Consider personal interests, professional
background, lifestyle values, and recent
activities. Return 5 diverse topics.</pre>
      </div>
      <div class="filter-tabs" id="filterTabs">
        <button class="filter-tab active" data-filter="all">All</button>
        <button class="filter-tab" data-filter="normie">Normies</button>
        <button class="filter-tab" data-filter="luminary">Tech</button>
        <button class="filter-tab" data-filter="culture">Culture</button>
      </div>

      <div class="persona-list" id="personaList"></div>

      <div class="persona-details" id="personaDetails">
        <div class="section-label">About</div>
        <p class="persona-bio" id="personaBio"></p>

        <div class="section-header">
          <span class="section-label">Interests</span>
          <button class="prompt-toggle-btn" data-prompt="cardPrompt" title="Show prompt">‚ú¶</button>
        </div>
        <div class="prompt-box" id="cardPrompt">
          <div class="label">Card Generation Prompt</div>
          <pre>For topic "{topic}" and persona:
Generate headline (5-8 words),
subheadline (15-20 words), and
atmospheric image prompt. Match
tone to persona's sophistication.</pre>
        </div>
        <div class="memories" id="personaMemories"></div>

        <button class="generate-btn" id="generateBtn">Generate Recommendations</button>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main">
      <div class="top-panel">
        <div class="style-selector-wrapper">
          <div class="style-selector-main" id="styleSelector">
            <div class="style-btn-group">
              <button class="style-btn active" data-style="photo"><span class="icon">üì∑</span> Photo</button>
              <button class="style-prompt-btn" data-style="photo" title="Show photo prompt">‚ú¶</button>
            </div>
            <div class="style-btn-group">
              <button class="style-btn" data-style="illustration"><span class="icon">üé®</span> Illustration</button>
              <button class="style-prompt-btn" data-style="illustration" title="Show illustration prompt">‚ú¶</button>
            </div>
            <div class="style-btn-group">
              <button class="style-btn" data-style="3d"><span class="icon">üßä</span> 3D</button>
              <button class="style-prompt-btn" data-style="3d" title="Show 3D prompt">‚ú¶</button>
            </div>
            <div class="style-btn-group">
              <button class="style-btn" data-style="minimal"><span class="icon">‚óªÔ∏è</span> Minimal</button>
              <button class="style-prompt-btn" data-style="minimal" title="Show minimal prompt">‚ú¶</button>
            </div>
          </div>
        </div>
        <div class="model-toggle" id="modelToggle">
          <button class="model-btn active" data-model="gemini"><span class="model-icon">‚ú¶</span> Gemini</button>
          <button class="model-btn" data-model="bytedance"><span class="model-icon">‚óÜ</span> ByteDance</button>
        </div>
      </div>
      <div class="card-area">
        <div class="card-stack-container" id="cardStackContainer">
          <div class="card-stack" id="cardStack">
            <div class="empty-state">
              <div class="icon">‚Üê</div>
              <p>Select a persona from the sidebar<br>to generate personalized cards</p>
            </div>
          </div>
        </div>
        <div class="stack-indicator" id="stackIndicator"></div>
        <div class="tap-hint" id="tapHint" style="display: none;">Tap a card to explore ‚Ä¢ Use arrow keys to browse</div>

        <!-- Mini Apps Section (inline below cards) -->
        <div class="mini-apps-section" id="miniAppsSection">
          <div class="mini-apps-header">
            <div>
              <h3 id="miniAppsTitle">Category</h3>
              <span id="miniAppsSubtitle">Explore mini-apps</span>
            </div>
            <button class="mini-apps-close" id="miniAppsClose">√ó</button>
          </div>
          <div class="mini-apps-grid" id="miniAppsList"></div>
        </div>
      </div>
    </main>

    <!-- Bottom Panel for Prompt Editing -->
    <div class="bottom-panel" id="bottomPanel">
      <div class="bottom-panel-inner">
        <div class="bottom-panel-header">
          <span class="bottom-panel-title">Prompt Templates</span>
        </div>
        <div class="bottom-panel-pills" id="promptPills">
          <button class="prompt-pill" data-prompt="system">System</button>
          <button class="prompt-pill" data-prompt="headline">Headline</button>
          <button class="prompt-pill" data-prompt="subheadline">Subheadline</button>
          <button class="prompt-pill" data-prompt="image">Image</button>
        </div>
      </div>
    </div>

    <!-- Prompt Editor Modal -->
    <div class="prompt-modal-overlay" id="promptModal">
      <div class="prompt-modal">
        <div class="prompt-modal-header">
          <span class="prompt-modal-title" id="promptModalTitle">Edit Prompt</span>
          <button class="prompt-modal-close" id="promptModalClose">√ó</button>
        </div>
        <textarea id="promptTextarea" placeholder="Enter your prompt template..."></textarea>
        <div class="prompt-modal-actions">
          <button class="prompt-modal-btn reset" id="resetPromptBtn">Reset to Default</button>
          <button class="prompt-modal-btn save" id="savePromptBtn">Save</button>
        </div>
      </div>
    </div>

    <!-- Success Toast -->
    <div class="success-toast" id="successToast">‚úì Prompt saved successfully</div>
  </div>

  <script>
    // Visual styles with prompts
    const visualStyles = {
      photo: {
        label: 'Photo',
        prompt: 'Editorial photography style, natural lighting, shallow depth of field, magazine quality, atmospheric and evocative.',
        images: {} // Will use default Unsplash photos
      },
      illustration: {
        label: 'Illustration',
        prompt: 'Hand-painted gouache illustration with visible brushstrokes, soft painterly style inspired by Studio Ghibli, warm atmospheric lighting, dreamy and whimsical.',
        images: {}
      },
      '3d': {
        label: '3D Render',
        prompt: 'Cinema 4D style 3D render, soft lighting, pastel colors, abstract geometric shapes, clean minimalist composition, octane render quality.',
        images: {}
      },
      minimal: {
        label: 'Minimal',
        prompt: 'Minimalist graphic design, solid color blocks, simple geometric shapes, bold typography integration, Bauhaus inspired.',
        images: {}
      }
    };

    // Personas organized by type
    const personas = [
      // Normies - everyday people with relatable interests
      {
        id: 'sarah-chen',
        name: 'Sarah Chen',
        age: 28,
        role: 'Product Designer',
        type: 'normie',
        avatar: 'https://images.unsplash.com/photo-1580489944761-15a19d654956?w=200&q=80&fit=crop&crop=face',
        bio: 'Design lead at a fintech startup. Obsessed with good coffee, weekend hiking, and finding the perfect work-life balance. Currently learning pottery on Sundays.',
        memories: ['design systems', 'specialty coffee', 'hiking trails', 'ceramics', 'remote work', 'plant care']
      },
      {
        id: 'marcus-johnson',
        name: 'Marcus Johnson',
        age: 34,
        role: 'High School Teacher',
        type: 'normie',
        avatar: 'https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=200&q=80&fit=crop&crop=face',
        bio: 'History teacher and basketball coach. Believes in the power of storytelling to connect with students. Weekend grill master and amateur woodworker.',
        memories: ['education', 'basketball', 'BBQ recipes', 'woodworking', 'podcasts', 'local history']
      },
      {
        id: 'zoe-martinez',
        name: 'Zoe Martinez',
        age: 22,
        role: 'College Student',
        type: 'normie',
        avatar: 'https://images.unsplash.com/photo-1524504388940-b1c1722653e1?w=200&q=80&fit=crop&crop=face',
        bio: 'Studying environmental science while working part-time at a coffee shop. Into thrifting, film photography, and planning road trips with friends.',
        memories: ['sustainability', 'vintage fashion', 'film cameras', 'road trips', 'coffee', 'indie music']
      },
      {
        id: 'david-kim',
        name: 'David Kim',
        age: 26,
        role: 'Software Engineer',
        type: 'normie',
        avatar: 'https://images.unsplash.com/photo-1519085360753-af0119f7cbe7?w=200&q=80&fit=crop&crop=face',
        bio: 'Backend developer who codes by day and games by night. Home automation enthusiast, amateur photographer, and dedicated dog dad to a golden retriever.',
        memories: ['coding', 'gaming', 'smart home', 'photography', 'dogs', 'mechanical keyboards']
      },
      {
        id: 'maya-patel',
        name: 'Maya Patel',
        age: 19,
        role: 'Content Creator',
        type: 'normie',
        avatar: 'https://images.unsplash.com/photo-1517841905240-472988babdf9?w=200&q=80&fit=crop&crop=face',
        bio: 'Just started posting lifestyle content on TikTok while figuring out what to do after high school. Loves skincare, anime, and trying new restaurants.',
        memories: ['social media', 'skincare routines', 'anime', 'food videos', 'aesthetics', 'K-pop']
      },
      {
        id: 'james-oconnor',
        name: 'James O\'Connor',
        age: 38,
        role: 'Marketing Manager',
        type: 'normie',
        avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=200&q=80&fit=crop&crop=face',
        bio: 'Works in tech marketing but lives for the weekends. Craft beer enthusiast, amateur cyclist, and dedicated fantasy football commissioner. Dad of two.',
        memories: ['marketing', 'craft beer', 'cycling', 'fantasy sports', 'parenting', 'grilling']
      },
      // Tech Luminaries
      {
        id: 'marc-andreessen',
        name: 'Marc Andreessen',
        age: 53,
        role: 'Venture Capitalist',
        type: 'luminary',
        avatar: 'https://media.hachyderm.io/media_attachments/files/113/691/722/294/061/460/original/d94833f50b93778d.jpeg',
        bio: 'Co-founder of Netscape and Andreessen Horowitz. Pioneer of the modern web browser. Believes software is eating the world and that technology is the primary driver of progress.',
        memories: ['venture capital', 'software eating the world', 'techno-optimism', 'web3', 'AI', 'founder mentality']
      },
      {
        id: 'elon-musk',
        name: 'Elon Musk',
        age: 53,
        role: 'Tech CEO',
        type: 'luminary',
        avatar: 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/34/Elon_Musk_Royal_Society_%28crop2%29.jpg/440px-Elon_Musk_Royal_Society_%28crop2%29.jpg',
        bio: 'CEO of Tesla and SpaceX. Obsessed with making humanity multi-planetary, accelerating sustainable energy, and pushing the boundaries of what\'s possible.',
        memories: ['space exploration', 'electric vehicles', 'neural interfaces', 'AI risk', 'first principles', 'Mars colonization']
      },
      {
        id: 'satya-nadella',
        name: 'Satya Nadella',
        age: 57,
        role: 'Microsoft CEO',
        type: 'luminary',
        avatar: 'https://upload.wikimedia.org/wikipedia/commons/thumb/7/78/MS-Exec-Nadella-Satya-2017-08-31-22_%28cropped%29.jpg/440px-MS-Exec-Nadella-Satya-2017-08-31-22_%28cropped%29.jpg',
        bio: 'CEO of Microsoft who transformed the company\'s culture. Believes in empathy, growth mindset, and the democratization of AI for every person and organization.',
        memories: ['cloud computing', 'growth mindset', 'empathy in leadership', 'AI democratization', 'cricket', 'poetry']
      },
      {
        id: 'jensen-huang',
        name: 'Jensen Huang',
        age: 61,
        role: 'NVIDIA CEO',
        type: 'luminary',
        avatar: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/e7/Jensen_Huang_GTC_Keynote_%282024%29.png/440px-Jensen_Huang_GTC_Keynote_%282024%29.png',
        bio: 'Founder and CEO of NVIDIA. Pioneered GPU computing and positioned the company at the center of the AI revolution. Known for his leather jacket and intense focus.',
        memories: ['GPU computing', 'AI acceleration', 'gaming', 'data centers', 'robotics', 'autonomous systems']
      },
      {
        id: 'sam-altman',
        name: 'Sam Altman',
        age: 39,
        role: 'OpenAI CEO',
        type: 'luminary',
        avatar: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/ef/Sam_Altman_-_TechCrunch_SF_2019_%28cropped%29.jpg/440px-Sam_Altman_-_TechCrunch_SF_2019_%28cropped%29.jpg',
        bio: 'CEO of OpenAI. Former president of Y Combinator. Believes AGI will be the most transformative technology in human history and is focused on ensuring it benefits everyone.',
        memories: ['artificial general intelligence', 'startup acceleration', 'nuclear energy', 'universal basic income', 'longevity', 'San Francisco']
      },
      {
        id: 'sundar-pichai',
        name: 'Sundar Pichai',
        age: 52,
        role: 'Google CEO',
        type: 'luminary',
        avatar: 'https://upload.wikimedia.org/wikipedia/commons/thumb/d/d6/Sundar_Pichai_%2832522152118%29_%28cropped%29.jpg/440px-Sundar_Pichai_%2832522152118%29_%28cropped%29.jpg',
        bio: 'CEO of Google and Alphabet. Rose through Chrome and Android to lead one of the world\'s most influential companies. Focuses on making AI helpful for everyone.',
        memories: ['search', 'Android', 'Chrome', 'AI for good', 'quantum computing', 'cricket']
      },
      // Culture & Sports
      {
        id: 'tony-hawk',
        name: 'Tony Hawk',
        age: 56,
        role: 'Pro Skateboarder',
        type: 'culture',
        avatar: 'https://upload.wikimedia.org/wikipedia/commons/thumb/a/a1/Tony_Hawk_by_Gage_Skidmore.jpg/440px-Tony_Hawk_by_Gage_Skidmore.jpg',
        bio: 'Legendary skateboarder who landed the first 900. Built a skateboarding empire through video games, media, and the Birdhouse brand. Still skating in his 50s.',
        memories: ['skateboarding', 'vert skating', 'video games', 'X Games', 'entrepreneurship', 'persistence']
      },
      {
        id: 'tyler-creator',
        name: 'Tyler, the Creator',
        age: 33,
        role: 'Artist & Designer',
        type: 'culture',
        avatar: 'https://upload.wikimedia.org/wikipedia/commons/thumb/1/11/Tyler%2C_the_Creator_-_Roskilde_Festival_2015.jpg/440px-Tyler%2C_the_Creator_-_Roskilde_Festival_2015.jpg',
        bio: 'Grammy-winning artist, fashion designer, and creative polymath. Founded Odd Future and Golf Wang. Known for bold aesthetics and genre-defying music.',
        memories: ['music production', 'fashion design', 'Golf le Fleur', 'Camp Flog Gnaw', 'visual art', 'creative independence']
      },
      {
        id: 'emma-chamberlain',
        name: 'Emma Chamberlain',
        age: 23,
        role: 'Content Creator',
        type: 'culture',
        avatar: 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/6b/Emma_Chamberlain_-_2023.jpg/440px-Emma_Chamberlain_-_2023.jpg',
        bio: 'YouTube pioneer who redefined internet authenticity. Built Chamberlain Coffee into a major brand. Known for her unfiltered style and cultural influence.',
        memories: ['content creation', 'coffee culture', 'fashion', 'podcasting', 'Gen Z culture', 'authenticity']
      },
      {
        id: 'simone-biles',
        name: 'Simone Biles',
        age: 27,
        role: 'Olympic Gymnast',
        type: 'culture',
        avatar: 'https://upload.wikimedia.org/wikipedia/commons/thumb/1/1a/Simone_Biles_in_2024_%28cropped%29.jpg/440px-Simone_Biles_in_2024_%28cropped%29.jpg',
        bio: 'Most decorated gymnast in history. Advocate for mental health in sports. Known for pushing the boundaries of what\'s physically possible.',
        memories: ['gymnastics', 'mental health', 'Olympics', 'athletic excellence', 'resilience', 'advocacy']
      },
      {
        id: 'pharrell-williams',
        name: 'Pharrell Williams',
        age: 51,
        role: 'Producer & Designer',
        type: 'culture',
        avatar: 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/52/Pharrell_Williams_2023.jpg/440px-Pharrell_Williams_2023.jpg',
        bio: 'Grammy-winning producer, Louis Vuitton Men\'s creative director, and cultural architect. Built The Neptunes, N.E.R.D, and countless hits across decades.',
        memories: ['music production', 'luxury fashion', 'Billionaire Boys Club', 'Louis Vuitton', 'timeless style', 'collaboration']
      },
      {
        id: 'nyjah-huston',
        name: 'Nyjah Huston',
        age: 29,
        role: 'Pro Skateboarder',
        type: 'culture',
        avatar: 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/80/Nyjah_Huston_2022.jpg/440px-Nyjah_Huston_2022.jpg',
        bio: 'Highest-paid skateboarder and Olympic medalist. Known for technical street skating and fearless approach. Builds skate plazas and trains relentlessly.',
        memories: ['street skating', 'Olympics', 'competitions', 'fitness training', 'skateboard tech', 'mental focus']
      }
    ];

    // Topics by persona - general interest categories
    const topicsByPersona = {
      // Normies - everyday relatable topics
      'sarah-chen': [
        { topic: 'Design', headline: 'Design Systems 101', subheadline: 'Create consistent, scalable visual languages', image: 'https://images.unsplash.com/photo-1561070791-2526d30994b5?w=800&q=80' },
        { topic: 'Coffee', headline: 'Better Coffee at Home', subheadline: 'Simple techniques for caf√©-quality brews', image: 'https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?w=800&q=80' },
        { topic: 'Outdoors', headline: 'Day Hikes Near You', subheadline: 'Find trails for every skill level', image: 'https://images.unsplash.com/photo-1551632811-561732d1e306?w=800&q=80' },
        { topic: 'Hobbies', headline: 'Getting Into Ceramics', subheadline: 'Start your pottery journey today', image: 'https://images.unsplash.com/photo-1565193566173-7a0ee3dbe261?w=800&q=80' },
        { topic: 'Home', headline: 'Indoor Plant Guide', subheadline: 'Keep your houseplants thriving', image: 'https://images.unsplash.com/photo-1545241047-6083a3684587?w=800&q=80' }
      ],
      'marcus-johnson': [
        { topic: 'Education', headline: 'Learn Anything Faster', subheadline: 'Science-backed study techniques', image: 'https://images.unsplash.com/photo-1503676260728-1c00da094a0b?w=800&q=80' },
        { topic: 'Sports', headline: 'Basketball Fundamentals', subheadline: 'Improve your game step by step', image: 'https://images.unsplash.com/photo-1546519638-68e109498ffc?w=800&q=80' },
        { topic: 'Food', headline: 'BBQ Essentials', subheadline: 'Master the grill this weekend', image: 'https://images.unsplash.com/photo-1529193591184-b1d58069ecdd?w=800&q=80' },
        { topic: 'DIY', headline: 'Woodworking Basics', subheadline: 'Build your first project', image: 'https://images.unsplash.com/photo-1504148455328-c376907d081c?w=800&q=80' },
        { topic: 'Learning', headline: 'Best Podcasts Right Now', subheadline: 'What to listen to this week', image: 'https://images.unsplash.com/photo-1478737270239-2f02b77fc618?w=800&q=80' }
      ],
      'zoe-martinez': [
        { topic: 'Sustainability', headline: 'Eco-Friendly Living', subheadline: 'Small changes that matter', image: 'https://images.unsplash.com/photo-1542601906990-b4d3fb778b09?w=800&q=80' },
        { topic: 'Fashion', headline: 'Thrift Store Finds', subheadline: 'Score vintage gems for less', image: 'https://images.unsplash.com/photo-1558171813-4c088753af8f?w=800&q=80' },
        { topic: 'Photography', headline: 'Shoot Film Again', subheadline: 'Analog photography basics', image: 'https://images.unsplash.com/photo-1495745966610-2a67f2297e5e?w=800&q=80' },
        { topic: 'Travel', headline: 'Road Trip Planning', subheadline: 'Epic drives worth taking', image: 'https://images.unsplash.com/photo-1469854523086-cc02fe5d8800?w=800&q=80' },
        { topic: 'Music', headline: 'Indie Music Discovery', subheadline: 'Find your new favorites', image: 'https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=800&q=80' }
      ],
      'maya-patel': [
        { topic: 'Social Media', headline: 'Grow Your Following', subheadline: 'Content tips that work', image: 'https://images.unsplash.com/photo-1611162617474-5b21e879e113?w=800&q=80' },
        { topic: 'Skincare', headline: 'Skincare Routines', subheadline: 'Build your perfect routine', image: 'https://images.unsplash.com/photo-1556228578-0d85b1a4d571?w=800&q=80' },
        { topic: 'Anime', headline: 'Must-Watch Anime', subheadline: 'This season\'s best shows', image: 'https://images.unsplash.com/photo-1578632767115-351597cf2477?w=800&q=80' },
        { topic: 'Food', headline: 'Best Food Spots', subheadline: 'Where to eat right now', image: 'https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=800&q=80' },
        { topic: 'K-pop', headline: 'K-Pop Updates', subheadline: 'News from your favorites', image: 'https://images.unsplash.com/photo-1514525253161-7a46d19cd819?w=800&q=80' }
      ],
      'david-kim': [
        { topic: 'Tech', headline: 'Code Better Today', subheadline: 'Tips for cleaner, faster development', image: 'https://images.unsplash.com/photo-1555066931-4365d14bab8c?w=800&q=80' },
        { topic: 'Gaming', headline: 'Games Worth Playing', subheadline: 'This season\'s best picks', image: 'https://images.unsplash.com/photo-1538481199705-c710c4e965fc?w=800&q=80' },
        { topic: 'Smart Home', headline: 'Home Automation 101', subheadline: 'Make your home work for you', image: 'https://images.unsplash.com/photo-1558002038-1055907df827?w=800&q=80' },
        { topic: 'Photography', headline: 'Phone Photography Tips', subheadline: 'Take better photos instantly', image: 'https://images.unsplash.com/photo-1516035069371-29a1b244cc32?w=800&q=80' },
        { topic: 'Pets', headline: 'Happy Dog, Happy Life', subheadline: 'Everything for your best friend', image: 'https://images.unsplash.com/photo-1587300003388-59208cc962cb?w=800&q=80' }
      ],
      'james-oconnor': [
        { topic: 'Beer', headline: 'Discover Craft Beer', subheadline: 'Find your new favorite brew', image: 'https://images.unsplash.com/photo-1535958636474-b021ee887b13?w=800&q=80' },
        { topic: 'Cycling', headline: 'Best Bike Routes', subheadline: 'Scenic rides near you', image: 'https://images.unsplash.com/photo-1541625602330-2277a4c46182?w=800&q=80' },
        { topic: 'Sports', headline: 'Fantasy Sports Guide', subheadline: 'Draft smarter, win more', image: 'https://images.unsplash.com/photo-1489944440615-453fc2b6a9a9?w=800&q=80' },
        { topic: 'Parenting', headline: 'Parenting Hacks', subheadline: 'Make family life easier', image: 'https://images.unsplash.com/photo-1536640712-4d4c36ff0e4e?w=800&q=80' },
        { topic: 'Food', headline: 'Grilling Essentials', subheadline: 'Backyard cooking mastered', image: 'https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=800&q=80' }
      ],
      // Tech Luminaries
      'marc-andreessen': [
        { topic: 'Technology', headline: 'Tech Trends to Watch', subheadline: 'What\'s shaping the future', image: 'https://images.unsplash.com/photo-1518770660439-4636190af475?w=800&q=80' },
        { topic: 'Business', headline: 'Build Something Great', subheadline: 'Lessons from top founders', image: 'https://images.unsplash.com/photo-1451187580459-43490279c0fa?w=800&q=80' },
        { topic: 'Investing', headline: 'Smart Investing 101', subheadline: 'Grow your wealth wisely', image: 'https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=800&q=80' },
        { topic: 'AI', headline: 'AI Tools You Need', subheadline: 'Work smarter with AI', image: 'https://images.unsplash.com/photo-1677442136019-21780ecad995?w=800&q=80' },
        { topic: 'Media', headline: 'Future of Media', subheadline: 'How we\'ll consume content', image: 'https://images.unsplash.com/photo-1504711434969-e33886168f5c?w=800&q=80' }
      ],
      'elon-musk': [
        { topic: 'Space', headline: 'Space Exploration Today', subheadline: 'The new era of discovery', image: 'https://images.unsplash.com/photo-1614728894747-a83421e2b9c9?w=800&q=80' },
        { topic: 'Problem Solving', headline: 'Think From First Principles', subheadline: 'Solve any problem better', image: 'https://images.unsplash.com/photo-1507413245164-6160d8298b31?w=800&q=80' },
        { topic: 'Sustainability', headline: 'Electric Vehicle Guide', subheadline: 'Is an EV right for you?', image: 'https://images.unsplash.com/photo-1593941707882-a5bba14938c7?w=800&q=80' },
        { topic: 'Science', headline: 'Brain-Computer Interfaces', subheadline: 'The future of human potential', image: 'https://images.unsplash.com/photo-1559757175-5700dde675bc?w=800&q=80' },
        { topic: 'Engineering', headline: 'How Things Get Built', subheadline: 'Inside modern manufacturing', image: 'https://images.unsplash.com/photo-1565043666747-69f6646db940?w=800&q=80' }
      ],
      'satya-nadella': [
        { topic: 'Leadership', headline: 'Lead With Empathy', subheadline: 'Build stronger teams', image: 'https://images.unsplash.com/photo-1522202176988-66273c2fd55f?w=800&q=80' },
        { topic: 'Cloud', headline: 'Cloud Computing Basics', subheadline: 'Understand the modern web', image: 'https://images.unsplash.com/photo-1451187580459-43490279c0fa?w=800&q=80' },
        { topic: 'Empathy', headline: 'Emotional Intelligence', subheadline: 'The skill that changes everything', image: 'https://images.unsplash.com/photo-1531746020798-e6953c6e8e04?w=800&q=80' },
        { topic: 'AI', headline: 'AI for Everyone', subheadline: 'Practical AI applications', image: 'https://images.unsplash.com/photo-1677442136019-21780ecad995?w=800&q=80' },
        { topic: 'Strategy', headline: 'Platform Thinking', subheadline: 'Build ecosystems, not products', image: 'https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=800&q=80' }
      ],
      'jensen-huang': [
        { topic: 'Computing', headline: 'GPU Revolution', subheadline: 'Why graphics cards power AI', image: 'https://images.unsplash.com/photo-1591799264318-7e6ef8ddb7ea?w=800&q=80' },
        { topic: 'Infrastructure', headline: 'Data Center Basics', subheadline: 'Where the cloud lives', image: 'https://images.unsplash.com/photo-1558494949-ef010cbdcc31?w=800&q=80' },
        { topic: 'Robotics', headline: 'Robots Among Us', subheadline: 'AI in the physical world', image: 'https://images.unsplash.com/photo-1485827404703-89b55fcc595e?w=800&q=80' },
        { topic: 'Gaming', headline: 'Gaming Tech Explained', subheadline: 'What powers your games', image: 'https://images.unsplash.com/photo-1542751371-adc38448a05e?w=800&q=80' },
        { topic: 'Hardware', headline: 'Chip Technology', subheadline: 'The silicon inside everything', image: 'https://images.unsplash.com/photo-1518770660439-4636190af475?w=800&q=80' }
      ],
      'sam-altman': [
        { topic: 'AI', headline: 'Understanding AI', subheadline: 'What it is and where it\'s going', image: 'https://images.unsplash.com/photo-1677442136019-21780ecad995?w=800&q=80' },
        { topic: 'Safety', headline: 'AI Safety Basics', subheadline: 'Building responsible technology', image: 'https://images.unsplash.com/photo-1620712943543-bcc4688e7485?w=800&q=80' },
        { topic: 'Startups', headline: 'Startup Fundamentals', subheadline: 'Build a company that lasts', image: 'https://images.unsplash.com/photo-1559136555-9303baea8ebd?w=800&q=80' },
        { topic: 'Energy', headline: 'Clean Energy Future', subheadline: 'Powering tomorrow\'s world', image: 'https://images.unsplash.com/photo-1473341304170-971dccb5ac1e?w=800&q=80' },
        { topic: 'Economics', headline: 'Future of Work', subheadline: 'How AI changes careers', image: 'https://images.unsplash.com/photo-1526304640581-d334cdbbf45e?w=800&q=80' }
      ],
      'sundar-pichai': [
        { topic: 'Search', headline: 'Search Smarter', subheadline: 'Get better results faster', image: 'https://images.unsplash.com/photo-1555949963-ff9fe0c870eb?w=800&q=80' },
        { topic: 'Impact', headline: 'Tech for Good', subheadline: 'Technology solving real problems', image: 'https://images.unsplash.com/photo-1532619675605-1ede6c2ed2b0?w=800&q=80' },
        { topic: 'Mobile', headline: 'Mobile First World', subheadline: 'Apps that matter', image: 'https://images.unsplash.com/photo-1512941937669-90a1b58e7e9c?w=800&q=80' },
        { topic: 'Quantum', headline: 'Quantum Computing 101', subheadline: 'The next computing frontier', image: 'https://images.unsplash.com/photo-1635070041078-e363dbe005cb?w=800&q=80' },
        { topic: 'Ethics', headline: 'Ethical Technology', subheadline: 'Building with responsibility', image: 'https://images.unsplash.com/photo-1531746790731-6c087fecd65a?w=800&q=80' }
      ],
      // Culture personas
      'tony-hawk': [
        { topic: 'Skateboarding', headline: 'Learn to Skate', subheadline: 'Get started on a board', image: 'https://images.unsplash.com/photo-1564982724940-ba0e7a6c0ed0?w=800&q=80' },
        { topic: 'Entrepreneurship', headline: 'Turn Passion Into Business', subheadline: 'Build around what you love', image: 'https://images.unsplash.com/photo-1547447134-cd3f5c716030?w=800&q=80' },
        { topic: 'Fitness', headline: 'Stay Active at Any Age', subheadline: 'Keep moving, keep growing', image: 'https://images.unsplash.com/photo-1621544402532-78c290378588?w=800&q=80' },
        { topic: 'Gaming', headline: 'Sports Video Games', subheadline: 'Best action sports games', image: 'https://images.unsplash.com/photo-1511512578047-dfb367046420?w=800&q=80' },
        { topic: 'Design', headline: 'Skate Park Design', subheadline: 'Architecture meets action', image: 'https://images.unsplash.com/photo-1572776685609-4e3f6e5a5e2b?w=800&q=80' }
      ],
      'tyler-creator': [
        { topic: 'Creativity', headline: 'Unlock Your Creativity', subheadline: 'Make something every day', image: 'https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=800&q=80' },
        { topic: 'Fashion', headline: 'Find Your Style', subheadline: 'Express yourself through clothes', image: 'https://images.unsplash.com/photo-1558171813-4c088753af8f?w=800&q=80' },
        { topic: 'Music', headline: 'Music Production Basics', subheadline: 'Make your first beat', image: 'https://images.unsplash.com/photo-1614613535308-eb5fbd3d2c17?w=800&q=80' },
        { topic: 'Community', headline: 'Build Your Community', subheadline: 'Find your people online', image: 'https://images.unsplash.com/photo-1598387993441-a364f854c3e1?w=800&q=80' },
        { topic: 'Events', headline: 'Host Better Events', subheadline: 'Bring people together', image: 'https://images.unsplash.com/photo-1459749411175-04bf5292ceea?w=800&q=80' }
      ],
      'emma-chamberlain': [
        { topic: 'Content', headline: 'Content Creation 101', subheadline: 'Start creating today', image: 'https://images.unsplash.com/photo-1611162617474-5b21e879e113?w=800&q=80' },
        { topic: 'Coffee', headline: 'Coffee Culture', subheadline: 'Explore the world of coffee', image: 'https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?w=800&q=80' },
        { topic: 'Business', headline: 'Creator Economy', subheadline: 'Turn content into career', image: 'https://images.unsplash.com/photo-1611162616305-c69b3fa7fbe0?w=800&q=80' },
        { topic: 'Style', headline: 'Thrift Shopping Tips', subheadline: 'Find unique pieces for less', image: 'https://images.unsplash.com/photo-1558171813-4c088753af8f?w=800&q=80' },
        { topic: 'Wellness', headline: 'Digital Wellness', subheadline: 'Balance screen time', image: 'https://images.unsplash.com/photo-1499209974431-9dddcece7f88?w=800&q=80' }
      ],
      'simone-biles': [
        { topic: 'Performance', headline: 'Peak Performance', subheadline: 'Achieve your athletic best', image: 'https://images.unsplash.com/photo-1566577739112-5180d4bf9390?w=800&q=80' },
        { topic: 'Mental Health', headline: 'Mental Health Matters', subheadline: 'Take care of your mind', image: 'https://images.unsplash.com/photo-1499209974431-9dddcece7f88?w=800&q=80' },
        { topic: 'Training', headline: 'Training Like a Pro', subheadline: 'Elite workout principles', image: 'https://images.unsplash.com/photo-1571019614242-c5c5dee9f50b?w=800&q=80' },
        { topic: 'Advocacy', headline: 'Use Your Voice', subheadline: 'Stand up for what matters', image: 'https://images.unsplash.com/photo-1529156069898-49953e39b3ac?w=800&q=80' },
        { topic: 'Legacy', headline: 'Build Your Legacy', subheadline: 'What you leave behind', image: 'https://images.unsplash.com/photo-1517836357463-d25dfeac3438?w=800&q=80' }
      ],
      'pharrell-williams': [
        { topic: 'Music', headline: 'Music Production', subheadline: 'Create your own sound', image: 'https://images.unsplash.com/photo-1598488035139-bdbb2231ce04?w=800&q=80' },
        { topic: 'Fashion', headline: 'Fashion Forward', subheadline: 'Stay ahead of trends', image: 'https://images.unsplash.com/photo-1558171813-4c088753af8f?w=800&q=80' },
        { topic: 'Culture', headline: 'Cultural Trends', subheadline: 'What\'s shaping culture now', image: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=800&q=80' },
        { topic: 'Collaboration', headline: 'Work Better Together', subheadline: 'The power of collaboration', image: 'https://images.unsplash.com/photo-1522202176988-66273c2fd55f?w=800&q=80' },
        { topic: 'Branding', headline: 'Build Your Brand', subheadline: 'Stand out and be remembered', image: 'https://images.unsplash.com/photo-1441986300917-64674bd600d8?w=800&q=80' }
      ],
      'nyjah-huston': [
        { topic: 'Skateboarding', headline: 'Street Skating', subheadline: 'See the city differently', image: 'https://images.unsplash.com/photo-1547447134-cd3f5c716030?w=800&q=80' },
        { topic: 'Competition', headline: 'Compete at Your Best', subheadline: 'Mental game mastery', image: 'https://images.unsplash.com/photo-1564982724940-ba0e7a6c0ed0?w=800&q=80' },
        { topic: 'Fitness', headline: 'Athletic Training', subheadline: 'Build strength and agility', image: 'https://images.unsplash.com/photo-1534438327276-14e5300c3a48?w=800&q=80' },
        { topic: 'Olympics', headline: 'Olympic Dreams', subheadline: 'The road to the games', image: 'https://images.unsplash.com/photo-1569517282132-25d22f4573e6?w=800&q=80' },
        { topic: 'Gear', headline: 'Gear Guide', subheadline: 'Equipment that performs', image: 'https://images.unsplash.com/photo-1531565637446-32307b194362?w=800&q=80' }
      ]
    };

    // Mini apps by broader topic categories
    const miniAppsByTopic = {
      // Tech & Business topics
      'Technology': [
        { name: 'Tech Trends', desc: 'Track emerging technologies and adoption', icon: 'üìä', color: '#6C5CE7' },
        { name: 'Industry Map', desc: 'See which sectors are being transformed', icon: 'üó∫Ô∏è', color: '#00B894' },
        { name: 'Startup Radar', desc: 'Discover innovative companies to watch', icon: 'üì°', color: '#E17055' },
        { name: 'Tech News', desc: 'Curated updates from the tech world', icon: 'üì∞', color: '#636E72' }
      ],
      'Business': [
        { name: 'Strategy Lab', desc: 'Tools for business planning and analysis', icon: 'üìã', color: '#6C5CE7' },
        { name: 'Market Watch', desc: 'Track market trends and opportunities', icon: 'üìà', color: '#00B894' },
        { name: 'Case Studies', desc: 'Learn from successful companies', icon: 'üìö', color: '#E17055' },
        { name: 'Network Hub', desc: 'Connect with business professionals', icon: 'ü§ù', color: '#636E72' }
      ],
      'Investing': [
        { name: 'Portfolio Tracker', desc: 'Monitor your investments in one place', icon: 'üí∞', color: '#00B894' },
        { name: 'Due Diligence', desc: 'Research tools for smart investing', icon: 'üîç', color: '#6C5CE7' },
        { name: 'Market News', desc: 'Real-time updates on markets', icon: 'üì∞', color: '#E17055' },
        { name: 'Learn Investing', desc: 'Courses on investment fundamentals', icon: 'üìñ', color: '#636E72' }
      ],
      'AI': [
        { name: 'AI Explorer', desc: 'Discover and try the latest AI tools', icon: 'ü§ñ', color: '#6C5CE7' },
        { name: 'Prompt Lab', desc: 'Master the art of AI prompting', icon: '‚ú®', color: '#00B894' },
        { name: 'AI News', desc: 'Stay updated on AI developments', icon: 'üì∞', color: '#E17055' },
        { name: 'Build with AI', desc: 'Tutorials for AI integration', icon: 'üîß', color: '#636E72' }
      ],
      'Space': [
        { name: 'Launch Tracker', desc: 'Follow upcoming rocket launches', icon: 'üöÄ', color: '#E17055' },
        { name: 'Night Sky', desc: 'Explore stars and planets above you', icon: 'üåå', color: '#6C5CE7' },
        { name: 'Space News', desc: 'Updates from the final frontier', icon: 'üì∞', color: '#00B894' },
        { name: 'Mission Archive', desc: 'History of space exploration', icon: 'üìö', color: '#636E72' }
      ],
      'Sustainability': [
        { name: 'Carbon Tracker', desc: 'Monitor your environmental impact', icon: 'üå±', color: '#00B894' },
        { name: 'Green Products', desc: 'Discover sustainable alternatives', icon: '‚ôªÔ∏è', color: '#6C5CE7' },
        { name: 'Climate News', desc: 'Updates on sustainability efforts', icon: 'üì∞', color: '#E17055' },
        { name: 'Action Guide', desc: 'Practical steps for a greener life', icon: 'üìã', color: '#636E72' }
      ],
      'Leadership': [
        { name: 'Leadership Lab', desc: 'Develop your management skills', icon: 'üéØ', color: '#6C5CE7' },
        { name: 'Team Builder', desc: 'Tools for building great teams', icon: 'üë•', color: '#00B894' },
        { name: 'Coach Connect', desc: 'Find mentors and coaches', icon: 'ü§ù', color: '#E17055' },
        { name: 'Daily Habits', desc: 'Routines of effective leaders', icon: 'üìÖ', color: '#636E72' }
      ],
      'Computing': [
        { name: 'Code Lab', desc: 'Interactive coding challenges', icon: 'üíª', color: '#6C5CE7' },
        { name: 'Tech Stack', desc: 'Explore modern development tools', icon: 'üîß', color: '#00B894' },
        { name: 'System Design', desc: 'Learn to architect at scale', icon: 'üìê', color: '#E17055' },
        { name: 'Dev News', desc: 'Updates for developers', icon: 'üì∞', color: '#636E72' }
      ],
      'Gaming': [
        { name: 'Game Finder', desc: 'Discover your next favorite game', icon: 'üéÆ', color: '#6C5CE7' },
        { name: 'Gaming News', desc: 'Updates from the gaming world', icon: 'üì∞', color: '#E17055' },
        { name: 'Stream Tools', desc: 'Everything for content creators', icon: 'üìπ', color: '#00B894' },
        { name: 'Community', desc: 'Connect with other gamers', icon: 'üë•', color: '#636E72' }
      ],
      'Robotics': [
        { name: 'Robot Lab', desc: 'Learn robotics fundamentals', icon: 'ü§ñ', color: '#6C5CE7' },
        { name: 'Project Ideas', desc: 'Inspiration for your next build', icon: 'üí°', color: '#00B894' },
        { name: 'Parts Finder', desc: 'Source components for projects', icon: 'üîß', color: '#E17055' },
        { name: 'Maker Community', desc: 'Connect with other builders', icon: 'üë•', color: '#636E72' }
      ],
      // Lifestyle & Culture topics
      'Skateboarding': [
        { name: 'Trick Library', desc: 'Learn tricks with slow-motion breakdowns', icon: 'üõπ', color: '#E17055' },
        { name: 'Spot Finder', desc: 'Discover skateable spots near you', icon: 'üìç', color: '#00B894' },
        { name: 'Pro Videos', desc: 'Watch legendary video parts', icon: 'üé¨', color: '#6C5CE7' },
        { name: 'Progress Track', desc: 'Log and celebrate your milestones', icon: 'üìà', color: '#FDCB6E' }
      ],
      'Fashion': [
        { name: 'Style Guide', desc: 'Outfit ideas and inspiration', icon: 'üëî', color: '#E84393' },
        { name: 'Trend Watch', desc: 'What\'s happening in fashion', icon: 'üìà', color: '#6C5CE7' },
        { name: 'Closet Organizer', desc: 'Manage and plan your wardrobe', icon: 'üëö', color: '#00B894' },
        { name: 'Shop Smart', desc: 'Find deals on quality pieces', icon: 'üõçÔ∏è', color: '#E17055' }
      ],
      'Music': [
        { name: 'Beat Maker', desc: 'Create beats with intuitive tools', icon: 'ü•Å', color: '#6C5CE7' },
        { name: 'Discover', desc: 'Find your next favorite artist', icon: 'üéµ', color: '#00B894' },
        { name: 'Learn Music', desc: 'Courses on production and theory', icon: 'üìö', color: '#E17055' },
        { name: 'Collab Hub', desc: 'Connect with other musicians', icon: 'ü§ù', color: '#636E72' }
      ],
      'Creativity': [
        { name: 'Mood Builder', desc: 'Create visual mood boards', icon: 'üé®', color: '#E84393' },
        { name: 'Daily Prompts', desc: 'Creative exercises and challenges', icon: '‚ú®', color: '#6C5CE7' },
        { name: 'Inspo Feed', desc: 'Curated creative inspiration', icon: 'üí°', color: '#00B894' },
        { name: 'Share Work', desc: 'Get feedback on your projects', icon: 'üë•', color: '#E17055' }
      ],
      'Coffee': [
        { name: 'Brew Guide', desc: 'Perfect your coffee technique', icon: '‚òï', color: '#8B4513' },
        { name: 'Bean Finder', desc: 'Discover roasters and origins', icon: 'üåç', color: '#00B894' },
        { name: 'Caf√© Map', desc: 'Find the best coffee shops', icon: 'üó∫Ô∏è', color: '#E17055' },
        { name: 'Taste Log', desc: 'Track your coffee journey', icon: 'üìù', color: '#6C5CE7' }
      ],
      'Fitness': [
        { name: 'Workout Builder', desc: 'Create custom training plans', icon: 'üí™', color: '#E17055' },
        { name: 'Track Progress', desc: 'Log workouts and see gains', icon: 'üìà', color: '#00B894' },
        { name: 'Form Check', desc: 'Perfect your exercise technique', icon: 'üìê', color: '#6C5CE7' },
        { name: 'Nutrition Guide', desc: 'Fuel your performance', icon: 'ü•ó', color: '#FDCB6E' }
      ],
      'Wellness': [
        { name: 'Mindfulness', desc: 'Guided meditation and breathing', icon: 'üßò', color: '#6C5CE7' },
        { name: 'Sleep Better', desc: 'Improve your rest quality', icon: 'üò¥', color: '#00B894' },
        { name: 'Mood Journal', desc: 'Track and understand your feelings', icon: 'üìî', color: '#E17055' },
        { name: 'Habit Builder', desc: 'Create positive daily routines', icon: '‚úÖ', color: '#FDCB6E' }
      ],
      'Content': [
        { name: 'Content Planner', desc: 'Plan and schedule your posts', icon: 'üìÖ', color: '#74B9FF' },
        { name: 'Edit Suite', desc: 'Tools for photo and video editing', icon: '‚úÇÔ∏è', color: '#636E72' },
        { name: 'Analytics', desc: 'Track your content performance', icon: 'üìä', color: '#00B894' },
        { name: 'Creator Tips', desc: 'Learn from successful creators', icon: 'üí°', color: '#E17055' }
      ],
      'Mental Health': [
        { name: 'Daily Check-in', desc: 'Track your mental wellness', icon: 'üíö', color: '#00B894' },
        { name: 'Guided Support', desc: 'Resources for tough moments', icon: 'ü§ù', color: '#6C5CE7' },
        { name: 'Journaling', desc: 'Reflect and process thoughts', icon: 'üìî', color: '#E17055' },
        { name: 'Community', desc: 'Connect with supportive people', icon: 'üë•', color: '#636E72' }
      ],
      'Training': [
        { name: 'Program Builder', desc: 'Create structured training plans', icon: 'üìã', color: '#E17055' },
        { name: 'Video Analysis', desc: 'Review and improve technique', icon: 'üé¨', color: '#6C5CE7' },
        { name: 'Recovery Tools', desc: 'Optimize rest and regeneration', icon: 'üßò', color: '#00B894' },
        { name: 'Coach Connect', desc: 'Find expert guidance', icon: 'ü§ù', color: '#636E72' }
      ],
      'Competition': [
        { name: 'Event Finder', desc: 'Discover upcoming competitions', icon: 'üèÜ', color: '#FDCB6E' },
        { name: 'Prep Guide', desc: 'Get ready to compete', icon: 'üìã', color: '#E17055' },
        { name: 'Mental Game', desc: 'Performance psychology tools', icon: 'üß†', color: '#6C5CE7' },
        { name: 'Results Tracker', desc: 'Log and analyze your performance', icon: 'üìä', color: '#00B894' }
      ],
      // Default for any unmapped topics
      'default': [
        { name: 'Deep Dive', desc: 'Comprehensive guides and tutorials', icon: 'üìñ', color: '#6C5CE7' },
        { name: 'Practice Mode', desc: 'Interactive exercises and challenges', icon: 'üéØ', color: '#00B894' },
        { name: 'Community', desc: 'Connect with others interested in this topic', icon: 'üë•', color: '#E17055' },
        { name: 'News Feed', desc: 'Latest updates and developments', icon: 'üì∞', color: '#636E72' }
      ]
    };

    // Map additional topics to existing categories
    const topicAliases = {
      'Media': 'Business',
      'Strategy': 'Business',
      'Startups': 'Business',
      'Entrepreneurship': 'Business',
      'Branding': 'Business',
      'Cloud': 'Computing',
      'Hardware': 'Computing',
      'Infrastructure': 'Computing',
      'Quantum': 'Computing',
      'Science': 'Technology',
      'Engineering': 'Technology',
      'Problem Solving': 'Technology',
      'Safety': 'AI',
      'Ethics': 'AI',
      'Energy': 'Sustainability',
      'Economics': 'Business',
      'Impact': 'Sustainability',
      'Search': 'AI',
      'Mobile': 'Technology',
      'Empathy': 'Leadership',
      'Design': 'Creativity',
      'Style': 'Fashion',
      'Culture': 'Creativity',
      'Collaboration': 'Community',
      'Community': 'default',
      'Events': 'default',
      'Performance': 'Fitness',
      'Legacy': 'default',
      'Advocacy': 'default',
      'Olympics': 'Competition',
      'Gear': 'default'
    };

    // Helper to get mini apps for a topic
    function getMiniAppsForTopic(topic) {
      if (miniAppsByTopic[topic]) return miniAppsByTopic[topic];
      if (topicAliases[topic] && miniAppsByTopic[topicAliases[topic]]) {
        return miniAppsByTopic[topicAliases[topic]];
      }
      return miniAppsByTopic['default'];
    }

    let selectedPersona = null;
    let cards = [];
    let originalCards = []; // Keep track of original order for indicator
    let panelOpen = false;

    // Default prompt templates
    const defaultPrompts = {
      system: `You are an expert at creating personalized content recommendations. Given a persona and topic, generate engaging headlines and descriptions that would appeal to their interests and sophistication level.`,
      headline: `Create a compelling headline (5-8 words) that captures attention. Be specific and actionable. Match the tone to the persona's style - sophisticated for experts, approachable for general audiences.`,
      subheadline: `Write a supporting subheadline (10-15 words) that expands on the headline. Add context, hint at the value, and create curiosity. Keep it conversational.`,
      image: `Generate an atmospheric, evocative image that captures the mood and theme. Focus on composition, lighting, and emotional resonance. The image should feel editorial and premium.`
    };

    // Load saved prompts from localStorage or use defaults
    function loadPrompts() {
      const saved = localStorage.getItem('foryou-prompts');
      if (saved) {
        return { ...defaultPrompts, ...JSON.parse(saved) };
      }
      return { ...defaultPrompts };
    }

    let customPrompts = loadPrompts();
    let currentStyle = 'photo';
    let currentFilter = 'all';
    let currentModel = 'gemini'; // 'gemini' or 'bytedance'

    // Utility: debounce function
    function debounce(fn, delay) {
      let timeout;
      return function(...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => fn.apply(this, args), delay);
      };
    }

    // Initialize
    function init() {
      initModelToggle();
      initStyleSelector();
      initStylePromptToggles();
      initFilterTabs();
      initPromptToggles();
      initBottomPanel();
      renderPersonaList();

      document.getElementById('generateBtn').onclick = generateCards;

      // Keyboard navigation for card stack
      document.addEventListener('keydown', (e) => {
        if (cards.length === 0) return;
        if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
          navigateCards(1);
        } else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
          navigateCards(-1);
        }
      });
    }

    function initBottomPanel() {
      const pills = document.querySelectorAll('.prompt-pill');
      const modal = document.getElementById('promptModal');
      const modalTitle = document.getElementById('promptModalTitle');
      const modalClose = document.getElementById('promptModalClose');
      const textarea = document.getElementById('promptTextarea');
      const saveBtn = document.getElementById('savePromptBtn');
      const resetBtn = document.getElementById('resetPromptBtn');
      const successToast = document.getElementById('successToast');
      let activePrompt = null;

      const promptLabels = {
        system: 'Edit System Prompt',
        headline: 'Edit Headline Prompt',
        subheadline: 'Edit Subheadline Prompt',
        image: 'Edit Image Prompt'
      };

      function showToast(message) {
        successToast.textContent = message || '‚úì Prompt saved successfully';
        successToast.classList.add('visible');
        setTimeout(() => successToast.classList.remove('visible'), 3000);
      }

      function closeModal() {
        modal.classList.remove('visible');
        pills.forEach(p => p.classList.remove('active'));
        activePrompt = null;
      }

      pills.forEach(pill => {
        pill.onclick = () => {
          const promptKey = pill.dataset.prompt;

          // Show modal for this prompt
          pills.forEach(p => p.classList.remove('active'));
          pill.classList.add('active');
          modalTitle.textContent = promptLabels[promptKey] || 'Edit Prompt';
          textarea.value = customPrompts[promptKey] || defaultPrompts[promptKey];
          modal.classList.add('visible');
          activePrompt = promptKey;
          textarea.focus();
        };
      });

      modalClose.onclick = closeModal;

      // Close on overlay click
      modal.onclick = (e) => {
        if (e.target === modal) closeModal();
      };

      // Close on Escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && modal.classList.contains('visible')) {
          closeModal();
        }
      });

      saveBtn.onclick = () => {
        if (!activePrompt) return;
        customPrompts[activePrompt] = textarea.value;
        localStorage.setItem('foryou-prompts', JSON.stringify(customPrompts));

        // Close modal and show success toast
        closeModal();
        showToast('‚úì Prompt saved successfully');
      };

      resetBtn.onclick = () => {
        if (!activePrompt) return;
        textarea.value = defaultPrompts[activePrompt];
        customPrompts[activePrompt] = defaultPrompts[activePrompt];
        localStorage.setItem('foryou-prompts', JSON.stringify(customPrompts));

        closeModal();
        showToast('‚úì Prompt reset to default');
      };
    }


    function navigateCards(direction) {
      if (cards.length === 0) return;
      currentCardIndex = (currentCardIndex + direction + cards.length) % cards.length;
      updateActiveCard();
      if (panelOpen) {
        updatePanel(cards[currentCardIndex]);
      }
    }

    // Physics-based card swiping
    let cardOffsets = []; // Store random offsets for each card
    let isDragging = false;
    let dragStartX = 0;
    let dragStartY = 0;
    let dragCurrentX = 0;
    let dragCurrentY = 0;
    let dragVelocityX = 0;
    let lastDragX = 0;
    let lastDragTime = 0;
    let activeCardEl = null;

    function generateCardOffsets(count) {
      cardOffsets = [];
      for (let i = 0; i < count; i++) {
        cardOffsets.push({
          rotation: (Math.random() - 0.5) * 8, // -4 to 4 degrees
          offsetX: (Math.random() - 0.5) * 10, // -5 to 5 px
          offsetY: Math.random() * 3 // 0 to 3 px
        });
      }
    }

    function initSwipeGestures() {
      const stack = document.getElementById('cardStackContainer');

      // Touch events
      stack.addEventListener('touchstart', handleDragStart, { passive: false });
      stack.addEventListener('touchmove', handleDragMove, { passive: false });
      stack.addEventListener('touchend', handleDragEnd, { passive: true });
      stack.addEventListener('touchcancel', handleDragEnd, { passive: true });

      // Mouse events
      stack.addEventListener('mousedown', handleDragStart);
      document.addEventListener('mousemove', handleDragMove);
      document.addEventListener('mouseup', handleDragEnd);
    }

    function handleDragStart(e) {
      if (cards.length === 0) return;

      const point = e.touches ? e.touches[0] : e;
      dragStartX = point.clientX;
      dragStartY = point.clientY;
      dragCurrentX = 0;
      dragCurrentY = 0;
      lastDragX = 0;
      lastDragTime = Date.now();
      dragVelocityX = 0;
      isDragging = true;

      // Find the top card
      const stack = document.getElementById('cardStack');
      activeCardEl = stack.querySelector('.card.active');
      if (activeCardEl) {
        activeCardEl.classList.add('dragging');
      }

      if (e.type === 'mousedown') {
        e.preventDefault();
      }
    }

    function handleDragMove(e) {
      if (!isDragging || !activeCardEl) return;

      const point = e.touches ? e.touches[0] : e;
      dragCurrentX = point.clientX - dragStartX;
      dragCurrentY = point.clientY - dragStartY;

      // Calculate velocity
      const now = Date.now();
      const dt = now - lastDragTime;
      if (dt > 0) {
        dragVelocityX = (dragCurrentX - lastDragX) / dt * 16; // normalize to ~60fps
      }
      lastDragX = dragCurrentX;
      lastDragTime = now;

      // Apply transform with rotation based on drag distance
      const rotation = dragCurrentX * 0.05;
      const scale = 1 - Math.abs(dragCurrentX) * 0.0002;
      activeCardEl.style.transform = `translateX(${dragCurrentX}px) translateY(${dragCurrentY * 0.3}px) rotate(${rotation}deg) scale(${Math.max(0.95, scale)})`;

      if (e.cancelable) {
        e.preventDefault();
      }
    }

    function handleDragEnd(e) {
      if (!isDragging) return;
      isDragging = false;

      if (!activeCardEl) return;
      activeCardEl.classList.remove('dragging');

      const threshold = 80;
      const velocityThreshold = 3;
      const shouldSwipe = Math.abs(dragCurrentX) > threshold || Math.abs(dragVelocityX) > velocityThreshold;

      if (shouldSwipe && cards.length > 1) {
        // Animate card to back of stack
        const direction = dragCurrentX > 0 ? -1 : 1; // swipe left = next, swipe right = previous
        const totalCards = cards.length;

        // Calculate where the back of the stack is
        const backOffset = cardOffsets[currentCardIndex] || { rotation: 0, offsetX: 0, offsetY: 0 };
        const backRotation = backOffset.rotation + ((totalCards - 1) * 2 * direction);
        const backTranslateX = backOffset.offsetX + ((totalCards - 1) * 12 * direction);
        const backTranslateY = (totalCards - 1) * 3 + backOffset.offsetY;
        const backScale = 1 - ((totalCards - 1) * 0.03);

        activeCardEl.classList.add('to-back');
        activeCardEl.style.transform = `translateX(${backTranslateX}px) translateY(${backTranslateY}px) rotate(${backRotation}deg) scale(${backScale})`;
        activeCardEl.style.zIndex = 0;

        setTimeout(() => {
          navigateCards(direction);
        }, 300);
      } else {
        // Snap back with spring animation
        activeCardEl.classList.add('animating');
        activeCardEl.style.transform = 'translateX(0) translateY(0) rotate(0deg) scale(1)';

        setTimeout(() => {
          if (activeCardEl) {
            activeCardEl.classList.remove('animating');
          }
        }, 400);
      }

      setTimeout(() => {
        activeCardEl = null;
      }, 50);
      dragCurrentX = 0;
      dragCurrentY = 0;
    }

    function initModelToggle() {
      const toggle = document.getElementById('modelToggle');
      toggle.querySelectorAll('.model-btn').forEach(btn => {
        btn.onclick = () => {
          toggle.querySelectorAll('.model-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          currentModel = btn.dataset.model;
          console.log('Model changed to:', currentModel);
          // Re-render cards with new model's images
          if (cards.length > 0) {
            renderCardStack();
          }
        };
      });
    }

    function initPromptToggles() {
      document.querySelectorAll('.prompt-toggle-btn').forEach(btn => {
        btn.onclick = () => {
          const promptId = btn.dataset.prompt;
          const promptBox = document.getElementById(promptId);
          const isVisible = promptBox.classList.contains('visible');

          promptBox.classList.toggle('visible', !isVisible);
          btn.classList.toggle('active', !isVisible);
          btn.textContent = isVisible ? '‚ú¶' : '√ó';
        };
      });
    }

    function initStyleSelector() {
      const selector = document.getElementById('styleSelector');
      selector.querySelectorAll('.style-btn').forEach(btn => {
        btn.onclick = async () => {
          const previousStyle = currentStyle;
          selector.querySelectorAll('.style-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          currentStyle = btn.dataset.style;
          console.log('Style changed to:', currentStyle);

          // If we have cards and style changed, regenerate images
          if (cards.length > 0 && currentStyle !== previousStyle) {
            // Reset to original cards and regenerate
            if (selectedPersona) {
              await generateCards();
            }
          }
        };
      });
    }

    function initStylePromptToggles() {
      const modal = document.getElementById('promptModal');
      const modalTitle = document.getElementById('promptModalTitle');
      const textarea = document.getElementById('promptTextarea');
      const successToast = document.getElementById('successToast');

      document.querySelectorAll('.style-prompt-btn').forEach(btn => {
        btn.onclick = (e) => {
          e.stopPropagation();
          const style = btn.dataset.style;
          const styleLabel = visualStyles[style]?.label || style;

          modalTitle.textContent = `${styleLabel} Style Prompt`;
          textarea.value = visualStyles[style]?.prompt || 'No prompt defined';
          textarea.readOnly = true; // Style prompts are read-only for now
          modal.classList.add('visible');

          // Store reference for potential future editing
          modal.dataset.stylePrompt = style;
        };
      });
    }

    function initFilterTabs() {
      const tabs = document.getElementById('filterTabs');
      tabs.querySelectorAll('.filter-tab').forEach(tab => {
        tab.onclick = () => {
          tabs.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          currentFilter = tab.dataset.filter;
          renderPersonaList();
        };
      });
    }

    // Cache for rendered persona elements
    const personaElementCache = new Map();

    function renderPersonaList() {
      const list = document.getElementById('personaList');

      const filtered = currentFilter === 'all'
        ? personas
        : personas.filter(p => p.type === currentFilter);

      // Get current children IDs
      const currentIds = new Set(filtered.map(p => p.id));

      // Remove personas not in filtered list
      Array.from(list.children).forEach(child => {
        if (!currentIds.has(child.dataset.personaId)) {
          child.remove();
        }
      });

      // Add or update personas
      filtered.forEach((persona, index) => {
        let btn = personaElementCache.get(persona.id);

        if (!btn) {
          // Create new button only if not cached
          btn = document.createElement('button');
          btn.className = 'persona-btn';
          btn.dataset.personaId = persona.id;
          btn.innerHTML = `
            <img class="persona-avatar" src="${persona.avatar}" alt="${persona.name}" loading="eager" onerror="this.src='https://via.placeholder.com/80?text=${persona.name[0]}'">
            <div class="persona-btn-info">
              <div class="name">${persona.name}, ${persona.age}</div>
              <div class="role">${persona.role}</div>
            </div>
            ${persona.type === 'luminary' ? '<span class="persona-badge">Tech</span>' : ''}
            ${persona.type === 'culture' ? '<span class="persona-badge">Culture</span>' : ''}
          `;
          btn.onclick = () => selectPersona(persona);
          personaElementCache.set(persona.id, btn);
        }

        // Update active state
        btn.classList.toggle('active', selectedPersona?.id === persona.id);

        // Add to list if not already there
        if (!list.contains(btn)) {
          list.appendChild(btn);
        }
      });
    }

    function selectPersona(persona) {
      selectedPersona = persona;
      closePanel();

      renderPersonaList();

      // Show persona details
      document.getElementById('personaDetails').classList.add('visible');
      document.getElementById('personaBio').textContent = persona.bio;

      const memoriesEl = document.getElementById('personaMemories');
      memoriesEl.innerHTML = persona.memories.map(m => `<span class="memory-tag">${m}</span>`).join('');

      // Reset card stack
      document.getElementById('cardStack').innerHTML = `
        <div class="empty-state">
          <div class="icon">‚Üì</div>
          <p>Click "Generate Recommendations"<br>to create personalized cards</p>
        </div>
      `;
      document.getElementById('stackIndicator').innerHTML = '';
      document.getElementById('tapHint').style.display = 'none';
    }

    
    async function generateCards() {
      if (!selectedPersona) return;

      // Clone the array so we can manipulate it for the stack loop
      cards = [...(topicsByPersona[selectedPersona.id] || topicsByPersona['sarah-chen'])];
      // Add unique IDs to track original positions
      cards = cards.map((card, i) => ({ ...card, _originalIndex: i }));
      originalCards = [...cards];
      currentCardIndex = 0;

      // Generate fresh random offsets for the new cards
      generateCardOffsets(cards.length);

      document.getElementById('tapHint').style.display = 'block';

      // Render cards immediately with loading states for non-photo styles
      const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
      const needsGeneration = currentStyle !== 'photo' && !isLocalhost;

      // Mark cards as loading if we need to generate images
      if (needsGeneration) {
        cards = cards.map(card => ({ ...card, isLoading: true }));
      }

      // Render initial cards (with loading state if needed)
      renderCardStack();

      // Generate images progressively for non-photo styles
      if (currentStyle !== 'photo') {
        if (isLocalhost) {
          console.log('Image generation requires Vercel deployment');
        } else {
          // Generate images one by one and update cards as they complete
          for (let i = 0; i < cards.length; i++) {
            const card = cards[i];

            try {
              const response = await fetch('/api/generate-image', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  prompt: `${card.topic}: ${card.headline}. ${card.subheadline}`,
                  style: currentStyle,
                  generateImage: true
                })
              });

              if (response.ok) {
                const data = await response.json();
                cards[i] = {
                  ...card,
                  isLoading: false,
                  enhancedPrompt: data.imagePrompt,
                  geminiImage: data.gemini?.imageData || null,
                  bytedanceImage: data.bytedance?.imageUrl || null,
                  generatedImage: data.imageData || null
                };
              } else {
                console.log('API error:', await response.text());
                cards[i] = { ...card, isLoading: false };
              }
            } catch (e) {
              console.log('Image generation failed for card', i, e);
              cards[i] = { ...card, isLoading: false };
            }

            // Update just this card in the DOM
            updateCardInPlace(i);
          }
          originalCards = [...cards];
        }
      }

      // Open panel with first card
      openPanel(cards[0]);
    }

    let currentCardIndex = 0;

    function renderCardStack() {
      const stack = document.getElementById('cardStack');
      stack.innerHTML = '';

      if (cards.length === 0) return;

      // Render all cards in carousel
      cards.forEach((card, i) => {
        const cardEl = createCardElement(card, i);
        cardEl.onclick = () => {
          currentCardIndex = i;
          updateActiveCard();
          openPanel(card);
        };
        stack.appendChild(cardEl);
      });

      renderStackIndicator();

      // Scroll to center on first card
      setTimeout(() => {
        const firstCard = stack.children[currentCardIndex];
        if (firstCard) {
          firstCard.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
        }
      }, 100);

      // Add scroll listener to update active card
      stack.onscroll = debounce(() => {
        const stackRect = stack.getBoundingClientRect();
        const centerX = stackRect.left + stackRect.width / 2;

        let closestIndex = 0;
        let closestDistance = Infinity;

        Array.from(stack.children).forEach((card, i) => {
          const cardRect = card.getBoundingClientRect();
          const cardCenterX = cardRect.left + cardRect.width / 2;
          const distance = Math.abs(cardCenterX - centerX);
          if (distance < closestDistance) {
            closestDistance = distance;
            closestIndex = i;
          }
        });

        if (closestIndex !== currentCardIndex) {
          currentCardIndex = closestIndex;
          renderStackIndicator();
          if (panelOpen && cards[currentCardIndex]) {
            updatePanel(cards[currentCardIndex]);
          }
        }
      }, 50);

      if (panelOpen && cards[currentCardIndex]) {
        updatePanel(cards[currentCardIndex]);
      }
    }

    function updateActiveCard() {
      // Re-render stack to apply new transforms
      renderCardStack();
    }

    function updateCardInPlace(index) {
      // Re-render the whole stack to maintain proper transforms and z-ordering
      renderCardStack();
    }

    function createCardElement(card, index) {
      const cardEl = document.createElement('div');
      cardEl.className = 'card';

      // Show loading state if card is still generating
      if (card.isLoading) {
        cardEl.innerHTML = `
          <div class="card-bg" style="background: linear-gradient(135deg, #f0f0f0 0%, #e0e0e0 100%)"></div>
          <div class="card-loading">
            <div class="card-loading-spinner">‚ú¶</div>
            <div class="card-loading-text">Generating ${currentStyle}...</div>
          </div>
          <div class="card-content">
            <div class="card-topic">${card.topic}</div>
            <div class="card-headline">${card.headline}</div>
            <div class="card-subheadline">${card.subheadline}</div>
          </div>
          <div class="card-style-badge">${visualStyles[currentStyle].label}</div>
        `;
        return cardEl;
      }

      // Use generated image based on current model selection, fall back to default
      let imageSource = card.image;
      let isGenerated = false;
      let modelLabel = '';
      let hasImage = true;

      if (currentModel === 'gemini' && card.geminiImage) {
        imageSource = card.geminiImage;
        isGenerated = true;
        modelLabel = 'Gemini';
      } else if (currentModel === 'bytedance' && card.bytedanceImage) {
        imageSource = card.bytedanceImage;
        isGenerated = true;
        modelLabel = 'ByteDance';
      } else if (card.generatedImage) {
        // Legacy fallback
        imageSource = card.generatedImage;
        isGenerated = true;
      }

      // Check if we have a valid image
      if (!imageSource || imageSource === 'undefined' || imageSource === 'null') {
        hasImage = false;
      }

      const badgeText = isGenerated
        ? `‚ú¶ ${modelLabel ? modelLabel + ' ‚Ä¢ ' : ''}${visualStyles[currentStyle].label}`
        : visualStyles[currentStyle].label;

      const bgStyle = hasImage
        ? `background-image: url('${imageSource}')`
        : `background: linear-gradient(135deg, #667eea 0%, #764ba2 100%)`;

      cardEl.innerHTML = `
        <div class="card-bg" style="${bgStyle}"></div>
        <div class="card-overlay"></div>
        ${!hasImage ? '<div class="card-no-image">No image available</div>' : ''}
        <div class="card-content">
          <div class="card-topic">${card.topic}</div>
          <div class="card-headline">${card.headline}</div>
          <div class="card-subheadline">${card.subheadline}</div>
        </div>
        <div class="card-style-badge">${badgeText}</div>
      `;

      cardEl.addEventListener('click', (e) => {
        if (!cardEl.classList.contains('dragging')) {
          openPanel(card);
        }
      });

      return cardEl;
    }

    function renderStackIndicator() {
      const indicator = document.getElementById('stackIndicator');
      if (cards.length === 0) return;

      indicator.innerHTML = cards.map((_, i) => {
        let className = 'stack-dot';
        if (i === currentCardIndex) className += ' active';
        return `<div class="${className}" onclick="goToCard(${i})"></div>`;
      }).join('');
    }

    function goToCard(index) {
      currentCardIndex = index;
      const stack = document.getElementById('cardStack');
      const targetCard = stack.children[index];
      if (targetCard) {
        targetCard.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
      }
      updateActiveCard();
    }

    function openPanel(card) {
      panelOpen = true;
      updatePanel(card);
      document.getElementById('miniAppsSection').classList.add('visible');
    }

    function updatePanel(card) {
      const apps = getMiniAppsForTopic(card.topic);

      document.getElementById('miniAppsTitle').textContent = card.topic;
      document.getElementById('miniAppsSubtitle').textContent = `${apps.length} mini-apps to explore`;

      const list = document.getElementById('miniAppsList');
      list.innerHTML = apps.map(app => `
        <div class="mini-app">
          <div class="mini-app-icon" style="background: ${app.color}">${app.icon}</div>
          <div class="mini-app-info">
            <h4>${app.name}</h4>
            <p>${app.desc}</p>
          </div>
        </div>
      `).join('');
    }

    function closePanel() {
      panelOpen = false;
      document.getElementById('miniAppsSection').classList.remove('visible');
    }

    // Initialize mini-apps close button
    document.getElementById('miniAppsClose').onclick = closePanel;

    init();
  </script>
</body>
</html>
