<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>For You Collections</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #ffffff;
      color: #1a1a1a;
      min-height: 100vh;
      overflow: hidden;
    }

    /* Three Column Layout */
    .layout {
      display: grid;
      grid-template-columns: 340px 1fr 0px;
      height: 100vh;
      transition: grid-template-columns 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .layout.panel-open {
      grid-template-columns: 340px 1fr 400px;
    }

    /* Left Sidebar */
    .sidebar {
      background: #fafafa;
      border-right: 1px solid #eee;
      padding: 24px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    .sidebar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .sidebar h1 {
      font-size: 1.25rem;
      font-weight: 600;
      color: #1a1a1a;
    }

    .prompts-toggle {
      padding: 6px 10px;
      background: transparent;
      border: 1px solid #ddd;
      color: #888;
      border-radius: 6px;
      font-size: 11px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .prompts-toggle:hover {
      border-color: #bbb;
      color: #666;
    }

    .prompts-toggle.active {
      background: #f0f0f0;
      border-color: #ccc;
      color: #555;
    }

    .section-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: #999;
      margin-bottom: 12px;
    }

    /* Visual Style Selector */
    .style-selector {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }

    .style-btn {
      padding: 8px 12px;
      background: #fff;
      border: 1px solid #e5e5e5;
      border-radius: 8px;
      font-size: 12px;
      color: #666;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .style-btn:hover {
      border-color: #ccc;
      background: #fafafa;
    }

    .style-btn.active {
      border-color: #1a1a1a;
      color: #1a1a1a;
      background: #f5f5f5;
    }

    .style-btn .icon {
      font-size: 14px;
    }

    /* Persona Filters */
    .filter-tabs {
      display: flex;
      gap: 4px;
      margin-bottom: 16px;
      background: #f0f0f0;
      padding: 4px;
      border-radius: 10px;
    }

    .filter-tab {
      flex: 1;
      padding: 8px 12px;
      background: transparent;
      border: none;
      border-radius: 8px;
      font-size: 12px;
      color: #888;
      cursor: pointer;
      transition: all 0.2s;
    }

    .filter-tab:hover {
      color: #666;
    }

    .filter-tab.active {
      background: #fff;
      color: #1a1a1a;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    /* Persona Selector */
    .persona-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 24px;
      max-height: 280px;
      overflow-y: auto;
    }

    .persona-btn {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 12px;
      background: transparent;
      border: 1px solid transparent;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: left;
    }

    .persona-btn:hover {
      background: #f5f5f5;
    }

    .persona-btn.active {
      background: #f0f0f0;
      border-color: #e0e0e0;
    }

    .persona-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #eee;
      flex-shrink: 0;
    }

    .persona-btn.active .persona-avatar {
      border-color: #1a1a1a;
    }

    .persona-btn-info {
      flex: 1;
      min-width: 0;
    }

    .persona-btn .name {
      font-size: 13px;
      font-weight: 500;
      color: #666;
      margin-bottom: 1px;
    }

    .persona-btn.active .name {
      color: #1a1a1a;
    }

    .persona-btn .role {
      font-size: 11px;
      color: #999;
    }

    .persona-badge {
      font-size: 9px;
      padding: 2px 6px;
      background: #e8e8e8;
      border-radius: 4px;
      color: #888;
      margin-left: auto;
    }

    /* Prompt Box */
    .prompt-box {
      background: #f5f5f5;
      border: 1px solid #eee;
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 20px;
      display: none;
    }

    .prompt-box.visible {
      display: block;
    }

    .prompt-box .label {
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #999;
      margin-bottom: 8px;
    }

    .prompt-box pre {
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 10px;
      color: #666;
      white-space: pre-wrap;
      line-height: 1.5;
    }

    /* Persona Details */
    .persona-details {
      flex: 1;
      display: none;
      flex-direction: column;
    }

    .persona-details.visible {
      display: flex;
    }

    .persona-bio {
      color: #666;
      line-height: 1.6;
      font-size: 13px;
      margin-bottom: 16px;
    }

    .memories {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin-bottom: 20px;
    }

    .memory-tag {
      background: #fff;
      border: 1px solid #e5e5e5;
      padding: 5px 9px;
      border-radius: 12px;
      font-size: 10px;
      color: #666;
    }

    .generate-btn {
      padding: 14px 24px;
      background: #1a1a1a;
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s;
      margin-top: auto;
    }

    .generate-btn:hover {
      background: #333;
    }

    .generate-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    /* Main Content - Card Stack */
    .main {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
      background: #f5f5f5;
      position: relative;
    }

    .card-area {
      width: 100%;
      max-width: 400px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .card-stack-container {
      position: relative;
      width: 100%;
      aspect-ratio: 3/4;
      max-height: 560px;
    }

    .card-stack {
      position: relative;
      width: 100%;
      height: 100%;
    }

    .card {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 24px;
      overflow: hidden;
      cursor: grab;
      touch-action: pan-y;
      transition: transform 0.1s ease-out;
      will-change: transform;
      box-shadow: 0 10px 40px rgba(0,0,0,0.15);
    }

    .card:active {
      cursor: grabbing;
    }

    .card.animating {
      transition: transform 0.4s ease-out, opacity 0.4s ease-out;
    }

    .card-bg {
      position: absolute;
      inset: 0;
      background-size: cover;
      background-position: center;
    }

    .card-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(to top, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.3) 40%, rgba(0,0,0,0.1) 100%);
    }

    .card-content {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 28px;
      color: #fff;
    }

    .card-topic {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: rgba(255,255,255,0.5);
      margin-bottom: 10px;
    }

    .card-headline {
      font-size: 1.5rem;
      font-weight: 600;
      line-height: 1.2;
      margin-bottom: 10px;
      color: #fff;
    }

    .card-subheadline {
      font-size: 14px;
      color: rgba(255,255,255,0.7);
      line-height: 1.5;
    }

    .card-counter {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(0,0,0,0.5);
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      color: rgba(255,255,255,0.7);
      backdrop-filter: blur(10px);
    }

    .card-style-badge {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(255,255,255,0.9);
      padding: 6px 10px;
      border-radius: 20px;
      font-size: 10px;
      color: #333;
      backdrop-filter: blur(10px);
    }

    .swipe-hint {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      opacity: 0;
      pointer-events: none;
      color: #fff;
    }

    .swipe-hint.left {
      left: 20px;
      background: #ff4444;
    }

    .swipe-hint.right {
      right: 20px;
      background: #44cc44;
    }

    /* Stack indicator */
    .stack-indicator {
      display: flex;
      justify-content: center;
      gap: 6px;
      margin-top: 20px;
    }

    .stack-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #ddd;
      transition: all 0.3s;
    }

    .stack-dot.active {
      background: #1a1a1a;
      width: 24px;
      border-radius: 4px;
    }

    .stack-dot.seen {
      background: #bbb;
    }

    .tap-hint {
      text-align: center;
      color: #999;
      font-size: 12px;
      margin-top: 16px;
    }

    /* Empty state */
    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: #bbb;
      text-align: center;
      padding: 40px;
    }

    .empty-state .icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    .empty-state p {
      font-size: 14px;
      line-height: 1.6;
    }

    /* Right Panel - Mini Apps */
    .panel {
      background: #fafafa;
      border-left: 1px solid #eee;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .panel-header {
      padding: 24px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      background: #fff;
    }

    .panel-header-info h2 {
      font-size: 1.1rem;
      margin-bottom: 4px;
      color: #1a1a1a;
    }

    .panel-header-info p {
      font-size: 12px;
      color: #999;
    }

    .panel-close {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      background: #f5f5f5;
      border: none;
      color: #999;
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .panel-close:hover {
      background: #eee;
      color: #666;
    }

    .panel-content {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
    }

    .mini-app {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 14px;
      background: #fff;
      border-radius: 14px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid #eee;
    }

    .mini-app:hover {
      border-color: #ddd;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .mini-app-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      flex-shrink: 0;
    }

    .mini-app-info {
      flex: 1;
      min-width: 0;
    }

    .mini-app-info h4 {
      font-size: 14px;
      margin-bottom: 3px;
      color: #1a1a1a;
    }

    .mini-app-info p {
      font-size: 12px;
      color: #888;
      line-height: 1.4;
    }

    .mini-app-arrow {
      color: #ccc;
      font-size: 16px;
    }

    .panel .prompt-box {
      margin: 0 0 16px 0;
    }

    .done-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: #999;
    }

    .done-state .checkmark {
      font-size: 56px;
      margin-bottom: 16px;
    }

    .done-state p {
      font-size: 15px;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .layout {
        grid-template-columns: 300px 1fr 0px;
      }
      .layout.panel-open {
        grid-template-columns: 300px 1fr 340px;
      }
    }

    @media (max-width: 768px) {
      .layout {
        grid-template-columns: 1fr;
      }
      .layout.panel-open {
        grid-template-columns: 1fr;
      }
      .sidebar {
        display: none;
      }
      .panel {
        position: fixed;
        inset: 0;
        z-index: 100;
        transform: translateX(100%);
        transition: transform 0.3s ease;
      }
      .layout.panel-open .panel {
        transform: translateX(0);
      }
    }
  </style>
</head>
<body>
  <div class="layout" id="layout">
    <!-- Left Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1>For You</h1>
        <button class="prompts-toggle" id="promptsToggle">Prompts</button>
      </div>

      <div class="section-label">Visual Style</div>
      <div class="style-selector" id="styleSelector">
        <button class="style-btn active" data-style="photo"><span class="icon">üì∑</span> Photo</button>
        <button class="style-btn" data-style="illustration"><span class="icon">üé®</span> Illustration</button>
        <button class="style-btn" data-style="3d"><span class="icon">üßä</span> 3D Render</button>
        <button class="style-btn" data-style="minimal"><span class="icon">‚óªÔ∏è</span> Minimal</button>
      </div>

      <div class="prompt-box" id="stylePrompt">
        <div class="label">Image Style Prompt</div>
        <pre id="stylePromptText">Editorial photography style,
natural lighting, shallow depth
of field, magazine quality,
atmospheric and evocative.</pre>
      </div>

      <div class="section-label">Persona Type</div>
      <div class="filter-tabs" id="filterTabs">
        <button class="filter-tab active" data-filter="all">All</button>
        <button class="filter-tab" data-filter="fictional">Fictional</button>
        <button class="filter-tab" data-filter="luminary">Luminaries</button>
      </div>

      <div class="persona-list" id="personaList"></div>

      <div class="persona-details" id="personaDetails">
        <div class="section-label">About</div>
        <p class="persona-bio" id="personaBio"></p>

        <div class="section-label">Interests</div>
        <div class="memories" id="personaMemories"></div>

        <div class="prompt-box" id="cardPrompt">
          <div class="label">Card Generation</div>
          <pre>For topic "{topic}" and persona:
Generate headline (5-8 words),
subheadline (15-20 words), and
atmospheric image prompt. Match
tone to persona's sophistication.</pre>
        </div>

        <button class="generate-btn" id="generateBtn">Generate Recommendations</button>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main">
      <div class="card-area">
        <div class="card-stack-container" id="cardStackContainer">
          <div class="card-stack" id="cardStack">
            <div class="empty-state">
              <div class="icon">‚Üê</div>
              <p>Select a persona from the sidebar<br>to generate personalized cards</p>
            </div>
          </div>
        </div>
        <div class="stack-indicator" id="stackIndicator"></div>
        <div class="tap-hint" id="tapHint" style="display: none;">Tap card to explore ‚Ä¢ Swipe to browse</div>
      </div>
    </main>

    <!-- Right Panel -->
    <aside class="panel" id="panel">
      <div class="panel-header">
        <div class="panel-header-info">
          <h2 id="panelTitle">Category</h2>
          <p id="panelSubtitle">Explore mini-apps</p>
        </div>
        <button class="panel-close" id="panelClose">√ó</button>
      </div>
      <div class="panel-content">
        <div class="prompt-box visible" id="miniAppsPrompt">
          <div class="label">Mini-Apps Generation</div>
          <pre>For category "{topic}" and persona:
Generate 4-5 relevant mini-apps with
name, description, icon emoji, and
color. Apps should feel like useful
tools within this category.</pre>
        </div>
        <div id="miniAppsList"></div>
      </div>
    </aside>
  </div>

  <script>
    // Visual styles with prompts
    const visualStyles = {
      photo: {
        label: 'Photo',
        prompt: 'Editorial photography style, natural lighting, shallow depth of field, magazine quality, atmospheric and evocative.',
        images: {} // Will use default Unsplash photos
      },
      illustration: {
        label: 'Illustration',
        prompt: 'Hand-painted gouache illustration with visible brushstrokes, soft painterly style inspired by Studio Ghibli, warm atmospheric lighting, dreamy and whimsical.',
        images: {}
      },
      '3d': {
        label: '3D Render',
        prompt: 'Cinema 4D style 3D render, soft lighting, pastel colors, abstract geometric shapes, clean minimalist composition, octane render quality.',
        images: {}
      },
      minimal: {
        label: 'Minimal',
        prompt: 'Minimalist graphic design, solid color blocks, simple geometric shapes, bold typography integration, Bauhaus inspired.',
        images: {}
      }
    };

    // Personas organized by type
    const personas = [
      // Fictional personas
      {
        id: 'creative-professional',
        name: 'Maya Chen',
        role: 'Creative Director',
        type: 'fictional',
        avatar: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=200&q=80',
        bio: 'A 34-year-old creative director based in Brooklyn. Passionate about sustainable design, experimental typography, and finding inspiration in urban architecture.',
        memories: ['sustainable design', 'typography', 'urban exploration', 'vintage books', 'gallery visits', 'brand identity']
      },
      {
        id: 'tech-entrepreneur',
        name: 'Alex Rivera',
        role: 'Startup Founder',
        type: 'fictional',
        avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=200&q=80',
        bio: 'A 29-year-old tech entrepreneur building their second startup in the AI space. Interested in productivity systems, meditation, and long-distance running.',
        memories: ['AI technology', 'productivity', 'meditation', 'running', 'sci-fi novels', 'system design']
      },
      {
        id: 'culinary-explorer',
        name: 'Sofia Russo',
        role: 'Food Writer',
        type: 'fictional',
        avatar: 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=200&q=80',
        bio: 'A 42-year-old food writer who spent years living in Italy and Japan. Obsessed with fermentation, seasonal cooking, and family recipes.',
        memories: ['Italian cuisine', 'Japanese cooking', 'fermentation', 'seasonal ingredients', 'food history']
      },
      {
        id: 'outdoor-minimalist',
        name: 'Kai Nakamura',
        role: 'Nature Photographer',
        type: 'fictional',
        avatar: 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=200&q=80',
        bio: 'A 38-year-old nature photographer living in a converted van. Documents wilderness areas and advocates for conservation.',
        memories: ['wilderness photography', 'van life', 'conservation', 'minimalism', 'mountain trails']
      },
      // Tech Luminaries
      {
        id: 'marc-andreessen',
        name: 'Marc Andreessen',
        role: 'Venture Capitalist',
        type: 'luminary',
        avatar: 'https://upload.wikimedia.org/wikipedia/commons/thumb/7/7d/Marc_Andreessen-9.jpg/440px-Marc_Andreessen-9.jpg',
        bio: 'Co-founder of Netscape and Andreessen Horowitz. Pioneer of the modern web browser. Believes software is eating the world and that technology is the primary driver of progress.',
        memories: ['venture capital', 'software eating the world', 'techno-optimism', 'web3', 'AI', 'founder mentality']
      },
      {
        id: 'elon-musk',
        name: 'Elon Musk',
        role: 'Tech CEO',
        type: 'luminary',
        avatar: 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/34/Elon_Musk_Royal_Society_%28crop2%29.jpg/440px-Elon_Musk_Royal_Society_%28crop2%29.jpg',
        bio: 'CEO of Tesla and SpaceX. Obsessed with making humanity multi-planetary, accelerating sustainable energy, and pushing the boundaries of what\'s possible.',
        memories: ['space exploration', 'electric vehicles', 'neural interfaces', 'AI risk', 'first principles', 'Mars colonization']
      },
      {
        id: 'satya-nadella',
        name: 'Satya Nadella',
        role: 'Microsoft CEO',
        type: 'luminary',
        avatar: 'https://upload.wikimedia.org/wikipedia/commons/thumb/7/78/MS-Exec-Nadella-Satya-2017-08-31-22_%28cropped%29.jpg/440px-MS-Exec-Nadella-Satya-2017-08-31-22_%28cropped%29.jpg',
        bio: 'CEO of Microsoft who transformed the company\'s culture. Believes in empathy, growth mindset, and the democratization of AI for every person and organization.',
        memories: ['cloud computing', 'growth mindset', 'empathy in leadership', 'AI democratization', 'cricket', 'poetry']
      },
      {
        id: 'jensen-huang',
        name: 'Jensen Huang',
        role: 'NVIDIA CEO',
        type: 'luminary',
        avatar: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/e7/Jensen_Huang_GTC_Keynote_%282024%29.png/440px-Jensen_Huang_GTC_Keynote_%282024%29.png',
        bio: 'Founder and CEO of NVIDIA. Pioneered GPU computing and positioned the company at the center of the AI revolution. Known for his leather jacket and intense focus.',
        memories: ['GPU computing', 'AI acceleration', 'gaming', 'data centers', 'robotics', 'autonomous systems']
      },
      {
        id: 'sam-altman',
        name: 'Sam Altman',
        role: 'OpenAI CEO',
        type: 'luminary',
        avatar: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/ef/Sam_Altman_-_TechCrunch_SF_2019_%28cropped%29.jpg/440px-Sam_Altman_-_TechCrunch_SF_2019_%28cropped%29.jpg',
        bio: 'CEO of OpenAI. Former president of Y Combinator. Believes AGI will be the most transformative technology in human history and is focused on ensuring it benefits everyone.',
        memories: ['artificial general intelligence', 'startup acceleration', 'nuclear energy', 'universal basic income', 'longevity', 'San Francisco']
      },
      {
        id: 'sundar-pichai',
        name: 'Sundar Pichai',
        role: 'Google CEO',
        type: 'luminary',
        avatar: 'https://upload.wikimedia.org/wikipedia/commons/thumb/d/d6/Sundar_Pichai_%2832522152118%29_%28cropped%29.jpg/440px-Sundar_Pichai_%2832522152118%29_%28cropped%29.jpg',
        bio: 'CEO of Google and Alphabet. Rose through Chrome and Android to lead one of the world\'s most influential companies. Focuses on making AI helpful for everyone.',
        memories: ['search', 'Android', 'Chrome', 'AI for good', 'quantum computing', 'cricket']
      }
    ];

    // Topics by persona
    const topicsByPersona = {
      'creative-professional': [
        { topic: 'Typography', headline: 'The Lost Art of Hand-Lettering', subheadline: 'How Brooklyn sign painters are keeping traditional letterforms alive in the digital age', image: 'https://images.unsplash.com/photo-1455390582262-044cdead277a?w=800&q=80' },
        { topic: 'Sustainable Design', headline: 'Materials That Give Back', subheadline: 'Exploring circular design principles through the work of five innovative studios', image: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&q=80' },
        { topic: 'Architecture', headline: 'Brutalism\'s Quiet Revival', subheadline: 'Why young architects are revisiting concrete poetry in residential spaces', image: 'https://images.unsplash.com/photo-1488972685288-c3fd157d7c7a?w=800&q=80' },
        { topic: 'Creative Process', headline: 'The 4AM Sketchbook', subheadline: 'Inside the morning rituals of designers who swear by pre-dawn creativity', image: 'https://images.unsplash.com/photo-1456735190827-d1262f71b8a3?w=800&q=80' },
        { topic: 'Visual Culture', headline: 'When Bookstores Were Galleries', subheadline: 'A photographic journey through the most beautiful independent bookshops', image: 'https://images.unsplash.com/photo-1507842217343-583bb7270b66?w=800&q=80' }
      ],
      'tech-entrepreneur': [
        { topic: 'AI & Creativity', headline: 'The Co-Pilot Mindset', subheadline: 'How founders are learning to think alongside AI rather than against it', image: 'https://images.unsplash.com/photo-1677442136019-21780ecad995?w=800&q=80' },
        { topic: 'Mindfulness', headline: 'The Silent Morning', subheadline: 'Why top founders are abandoning phones for meditation before 7AM', image: 'https://images.unsplash.com/photo-1506126613408-eca07ce68773?w=800&q=80' },
        { topic: 'Endurance', headline: 'Run to Build', subheadline: 'The unexpected connection between ultramarathons and startup resilience', image: 'https://images.unsplash.com/photo-1552674605-db6ffd4facb5?w=800&q=80' },
        { topic: 'Future Fiction', headline: 'Sci-Fi as Business Strategy', subheadline: 'The novels that predicted today\'s tech‚Äîand what they say about tomorrow', image: 'https://images.unsplash.com/photo-1451187580459-43490279c0fa?w=800&q=80' },
        { topic: 'Systems Thinking', headline: 'The Anti-Productivity System', subheadline: 'Counterintuitive frameworks for getting more done by doing less', image: 'https://images.unsplash.com/photo-1484480974693-6ca0a78fb36b?w=800&q=80' }
      ],
      'culinary-explorer': [
        { topic: 'Fermentation', headline: 'The Patience of Koji', subheadline: 'A 72-hour journey into Japan\'s most transformative ingredient', image: 'https://images.unsplash.com/photo-1563245372-f21724e3856d?w=800&q=80' },
        { topic: 'Italian Heritage', headline: 'Nonnas Never Measured', subheadline: 'Preserving recipes that exist only in muscle memory and love', image: 'https://images.unsplash.com/photo-1556761223-4c4282c73f77?w=800&q=80' },
        { topic: 'Seasonal Cooking', headline: 'The Winter Larder', subheadline: 'Ancient preservation techniques for a modern kitchen', image: 'https://images.unsplash.com/photo-1466637574441-749b8f19452f?w=800&q=80' },
        { topic: 'Food History', headline: 'When Empires Ate', subheadline: 'How trade routes shaped the dishes we now call home cooking', image: 'https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=800&q=80' },
        { topic: 'Kitchen Tools', headline: 'The Pan That Raised Me', subheadline: 'Personal essays on the heirloom cookware we\'ll never replace', image: 'https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=800&q=80' }
      ],
      'outdoor-minimalist': [
        { topic: 'Light & Landscape', headline: 'Chasing Golden Hour', subheadline: 'The photographer\'s obsession with those fleeting moments of perfect light', image: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800&q=80' },
        { topic: 'Conservation', headline: 'The Last Wild Places', subheadline: 'Documenting wilderness before it exists only in photographs', image: 'https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?w=800&q=80' },
        { topic: 'Minimalism', headline: 'Everything I Own Fits Here', subheadline: 'What two years of van life taught me about what actually matters', image: 'https://images.unsplash.com/photo-1523712999610-f77fbcfc3843?w=800&q=80' },
        { topic: 'Solitude', headline: 'The Gift of Being Alone', subheadline: 'Finding yourself in places where no one can find you', image: 'https://images.unsplash.com/photo-1501785888041-af3ef285b470?w=800&q=80' },
        { topic: 'Wildlife', headline: 'Patience as Practice', subheadline: 'The meditation of waiting for wildlife to reveal itself', image: 'https://images.unsplash.com/photo-1474511320723-9a56873571b7?w=800&q=80' }
      ],
      'marc-andreessen': [
        { topic: 'Software Revolution', headline: 'Why Software Still Eats Everything', subheadline: 'Two decades later, the thesis is stronger than ever‚Äîhere\'s what\'s being consumed next', image: 'https://images.unsplash.com/photo-1518770660439-4636190af475?w=800&q=80' },
        { topic: 'Techno-Optimism', headline: 'The Case for Building', subheadline: 'Why pessimism is a luxury we can\'t afford and optimism is a moral imperative', image: 'https://images.unsplash.com/photo-1451187580459-43490279c0fa?w=800&q=80' },
        { topic: 'Venture Capital', headline: 'Pattern Recognition', subheadline: 'What separates billion-dollar founders from everyone else', image: 'https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=800&q=80' },
        { topic: 'AI Future', headline: 'Intelligence Abundance', subheadline: 'When AI makes expertise free, what becomes truly valuable?', image: 'https://images.unsplash.com/photo-1677442136019-21780ecad995?w=800&q=80' },
        { topic: 'Media & Tech', headline: 'The Great Rebundling', subheadline: 'How technology is reconstructing media after a decade of unbundling', image: 'https://images.unsplash.com/photo-1504711434969-e33886168f5c?w=800&q=80' }
      ],
      'elon-musk': [
        { topic: 'Mars Colonization', headline: 'Making Life Multi-Planetary', subheadline: 'The engineering challenges of building a civilization on Mars', image: 'https://images.unsplash.com/photo-1614728894747-a83421e2b9c9?w=800&q=80' },
        { topic: 'First Principles', headline: 'Reasoning From Zero', subheadline: 'How to solve impossible problems by questioning every assumption', image: 'https://images.unsplash.com/photo-1507413245164-6160d8298b31?w=800&q=80' },
        { topic: 'Electric Future', headline: 'The S-Curve of Adoption', subheadline: 'Why the transition to sustainable energy is now unstoppable', image: 'https://images.unsplash.com/photo-1593941707882-a5bba14938c7?w=800&q=80' },
        { topic: 'Neural Interfaces', headline: 'Bandwidth to the Brain', subheadline: 'The next frontier of human-computer interaction', image: 'https://images.unsplash.com/photo-1559757175-5700dde675bc?w=800&q=80' },
        { topic: 'Manufacturing', headline: 'The Machine That Builds the Machine', subheadline: 'Why the factory is the product that matters most', image: 'https://images.unsplash.com/photo-1565043666747-69f6646db940?w=800&q=80' }
      ],
      'satya-nadella': [
        { topic: 'Growth Mindset', headline: 'Learn It All vs Know It All', subheadline: 'How changing Microsoft\'s culture changed everything', image: 'https://images.unsplash.com/photo-1522202176988-66273c2fd55f?w=800&q=80' },
        { topic: 'Cloud Computing', headline: 'The Intelligent Cloud', subheadline: 'Why cloud is the foundation of every modern business', image: 'https://images.unsplash.com/photo-1451187580459-43490279c0fa?w=800&q=80' },
        { topic: 'Empathy in Tech', headline: 'The Soft Edge of Innovation', subheadline: 'Why emotional intelligence is the hardest engineering problem', image: 'https://images.unsplash.com/photo-1531746020798-e6953c6e8e04?w=800&q=80' },
        { topic: 'AI Democratization', headline: 'AI for Every Developer', subheadline: 'Making artificial intelligence accessible to the next billion builders', image: 'https://images.unsplash.com/photo-1677442136019-21780ecad995?w=800&q=80' },
        { topic: 'Platform Thinking', headline: 'Ecosystems Over Products', subheadline: 'The strategic shift that powers modern tech giants', image: 'https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=800&q=80' }
      ],
      'jensen-huang': [
        { topic: 'GPU Revolution', headline: 'The Parallel Universe', subheadline: 'How graphics processors became the engine of artificial intelligence', image: 'https://images.unsplash.com/photo-1591799264318-7e6ef8ddb7ea?w=800&q=80' },
        { topic: 'AI Infrastructure', headline: 'Building the AI Factory', subheadline: 'Why data centers are the new oil refineries', image: 'https://images.unsplash.com/photo-1558494949-ef010cbdcc31?w=800&q=80' },
        { topic: 'Robotics', headline: 'Physical AI', subheadline: 'When artificial intelligence learns to move through the world', image: 'https://images.unsplash.com/photo-1485827404703-89b55fcc595e?w=800&q=80' },
        { topic: 'Gaming Technology', headline: 'The Simulation Hypothesis', subheadline: 'How gaming technology is creating new realities', image: 'https://images.unsplash.com/photo-1542751371-adc38448a05e?w=800&q=80' },
        { topic: 'Accelerated Computing', headline: 'The End of General Purpose', subheadline: 'Why specialized hardware is the future of computing', image: 'https://images.unsplash.com/photo-1518770660439-4636190af475?w=800&q=80' }
      ],
      'sam-altman': [
        { topic: 'AGI Progress', headline: 'The Road to Superintelligence', subheadline: 'Mapping the milestones between here and artificial general intelligence', image: 'https://images.unsplash.com/photo-1677442136019-21780ecad995?w=800&q=80' },
        { topic: 'AI Safety', headline: 'Aligned by Design', subheadline: 'Building AI systems that want what we want', image: 'https://images.unsplash.com/photo-1620712943543-bcc4688e7485?w=800&q=80' },
        { topic: 'Startup Building', headline: 'The YC Playbook', subheadline: 'Timeless principles for building companies that matter', image: 'https://images.unsplash.com/photo-1559136555-9303baea8ebd?w=800&q=80' },
        { topic: 'Energy & Compute', headline: 'The Power Bottleneck', subheadline: 'Why the AI future depends on solving energy abundance', image: 'https://images.unsplash.com/photo-1473341304170-971dccb5ac1e?w=800&q=80' },
        { topic: 'Economic Transformation', headline: 'Post-Scarcity Thinking', subheadline: 'What happens when intelligence becomes a commodity', image: 'https://images.unsplash.com/photo-1526304640581-d334cdbbf45e?w=800&q=80' }
      ],
      'sundar-pichai': [
        { topic: 'Search Evolution', headline: 'Beyond Ten Blue Links', subheadline: 'How AI is transforming the way we find information', image: 'https://images.unsplash.com/photo-1555949963-ff9fe0c870eb?w=800&q=80' },
        { topic: 'AI for Good', headline: 'Technology as Equalizer', subheadline: 'Using artificial intelligence to solve humanity\'s biggest challenges', image: 'https://images.unsplash.com/photo-1532619675605-1ede6c2ed2b0?w=800&q=80' },
        { topic: 'Mobile First', headline: 'The Android Decade', subheadline: 'How mobile transformed computing and what comes next', image: 'https://images.unsplash.com/photo-1512941937669-90a1b58e7e9c?w=800&q=80' },
        { topic: 'Quantum Computing', headline: 'Beyond Classical Limits', subheadline: 'The race to build computers that think differently', image: 'https://images.unsplash.com/photo-1635070041078-e363dbe005cb?w=800&q=80' },
        { topic: 'Responsible AI', headline: 'Building Trust at Scale', subheadline: 'The principles guiding AI development for billions of users', image: 'https://images.unsplash.com/photo-1531746790731-6c087fecd65a?w=800&q=80' }
      ]
    };

    // Mini apps by topic (keeping existing ones, adding new for luminaries)
    const miniAppsByTopic = {
      'Typography': [
        { name: 'Letter Lab', desc: 'Practice hand-lettering with guided stroke exercises', icon: '‚úçÔ∏è', color: '#2D3436' },
        { name: 'Type Pair', desc: 'AI-powered font pairing suggestions for your projects', icon: 'üî§', color: '#6C5CE7' },
        { name: 'Kerning Game', desc: 'Train your eye with interactive spacing challenges', icon: 'üìê', color: '#00B894' },
        { name: 'Font Scanner', desc: 'Identify typefaces from photos instantly', icon: 'üì∑', color: '#E17055' }
      ],
      'Sustainable Design': [
        { name: 'Material Index', desc: 'Browse eco-friendly materials with sourcing info', icon: 'üå±', color: '#00B894' },
        { name: 'Carbon Calc', desc: 'Estimate the environmental impact of design choices', icon: 'üìä', color: '#636E72' },
        { name: 'Circular Studio', desc: 'Design products with end-of-life in mind', icon: '‚ôªÔ∏è', color: '#74B9FF' },
        { name: 'Green Suppliers', desc: 'Directory of sustainable manufacturers', icon: 'üè≠', color: '#55A3A2' }
      ],
      'Architecture': [
        { name: 'Brutalist Map', desc: 'Discover concrete masterpieces near you', icon: 'üó∫Ô∏è', color: '#636E72' },
        { name: 'Structure Scan', desc: 'AR overlay showing building construction methods', icon: 'üì±', color: '#2D3436' },
        { name: 'Space Sketch', desc: 'Quick architectural concept drawings', icon: '‚úèÔ∏è', color: '#B2BEC3' },
        { name: 'Light Study', desc: 'Simulate natural light in any space', icon: '‚òÄÔ∏è', color: '#FDCB6E' }
      ],
      'Software Revolution': [
        { name: 'Market Map', desc: 'Track which industries are being software-ized', icon: 'üó∫Ô∏è', color: '#6C5CE7' },
        { name: 'Disruption Alert', desc: 'Early signals of software eating new sectors', icon: '‚ö°', color: '#E17055' },
        { name: 'Founder Radar', desc: 'Track emerging founders in key verticals', icon: 'üì°', color: '#00B894' },
        { name: 'Tech Thesis', desc: 'Build and test investment theses', icon: 'üìù', color: '#2D3436' }
      ],
      'Mars Colonization': [
        { name: 'Mars Sim', desc: 'Simulate colony building on the red planet', icon: 'üî¥', color: '#E17055' },
        { name: 'Rocket Math', desc: 'Calculate orbital mechanics and fuel needs', icon: 'üöÄ', color: '#2D3436' },
        { name: 'Habitat Designer', desc: 'Design pressurized living spaces', icon: 'üè†', color: '#636E72' },
        { name: 'Resource Planner', desc: 'Plan ISRU and supply chains', icon: '‚õèÔ∏è', color: '#FDCB6E' }
      ],
      'Growth Mindset': [
        { name: 'Mindset Check', desc: 'Daily reflection on fixed vs growth thinking', icon: 'üß†', color: '#6C5CE7' },
        { name: 'Learn Log', desc: 'Track your learning journey and insights', icon: 'üìö', color: '#00B894' },
        { name: 'Feedback Loop', desc: 'Structured feedback collection and analysis', icon: 'üîÑ', color: '#74B9FF' },
        { name: 'Culture Pulse', desc: 'Measure team mindset and culture health', icon: 'üíì', color: '#FD79A8' }
      ],
      'GPU Revolution': [
        { name: 'CUDA Lab', desc: 'Learn parallel programming interactively', icon: 'üíª', color: '#76B900' },
        { name: 'Benchmark', desc: 'Compare GPU performance across workloads', icon: 'üìä', color: '#2D3436' },
        { name: 'ML Optimizer', desc: 'Optimize your models for GPU inference', icon: '‚ö°', color: '#E17055' },
        { name: 'Chip Watch', desc: 'Track the GPU and AI chip landscape', icon: 'üëÅÔ∏è', color: '#636E72' }
      ],
      'AGI Progress': [
        { name: 'Capability Track', desc: 'Monitor AI benchmark progress over time', icon: 'üìà', color: '#6C5CE7' },
        { name: 'Safety Score', desc: 'Evaluate AI systems on alignment metrics', icon: 'üõ°Ô∏è', color: '#00B894' },
        { name: 'Research Radar', desc: 'Track breakthrough papers and discoveries', icon: 'üì°', color: '#E17055' },
        { name: 'Timeline Model', desc: 'Explore different AGI arrival scenarios', icon: '‚è≥', color: '#636E72' }
      ],
      'Search Evolution': [
        { name: 'Query Lab', desc: 'Explore how AI transforms search queries', icon: 'üîç', color: '#4285F4' },
        { name: 'Intent Map', desc: 'Understand user intent classification', icon: 'üß≠', color: '#00B894' },
        { name: 'Answer Engine', desc: 'Build AI-powered Q&A experiences', icon: 'üí¨', color: '#6C5CE7' },
        { name: 'Knowledge Graph', desc: 'Explore connected information structures', icon: 'üï∏Ô∏è', color: '#E17055' }
      ],
      // Add defaults for other topics
      'default': [
        { name: 'Deep Dive', desc: 'Comprehensive guides and tutorials', icon: 'üìñ', color: '#6C5CE7' },
        { name: 'Practice Mode', desc: 'Interactive exercises and challenges', icon: 'üéØ', color: '#00B894' },
        { name: 'Community', desc: 'Connect with others interested in this topic', icon: 'üë•', color: '#E17055' },
        { name: 'News Feed', desc: 'Latest updates and developments', icon: 'üì∞', color: '#636E72' }
      ]
    };

    // Add remaining mini-apps mappings
    const defaultTopics = ['Creative Process', 'Visual Culture', 'AI & Creativity', 'Mindfulness', 'Endurance',
      'Future Fiction', 'Systems Thinking', 'Fermentation', 'Italian Heritage', 'Seasonal Cooking', 'Food History',
      'Kitchen Tools', 'Light & Landscape', 'Conservation', 'Minimalism', 'Solitude', 'Wildlife',
      'Techno-Optimism', 'Venture Capital', 'AI Future', 'Media & Tech', 'First Principles', 'Electric Future',
      'Neural Interfaces', 'Manufacturing', 'Cloud Computing', 'Empathy in Tech', 'AI Democratization',
      'Platform Thinking', 'AI Infrastructure', 'Robotics', 'Gaming Technology', 'Accelerated Computing',
      'AI Safety', 'Startup Building', 'Energy & Compute', 'Economic Transformation', 'AI for Good',
      'Mobile First', 'Quantum Computing', 'Responsible AI'];

    defaultTopics.forEach(topic => {
      if (!miniAppsByTopic[topic]) {
        miniAppsByTopic[topic] = miniAppsByTopic['default'];
      }
    });

    let selectedPersona = null;
    let currentCardIndex = 0;
    let cards = [];
    let showPrompts = false;
    let panelOpen = false;
    let currentStyle = 'photo';
    let currentFilter = 'all';

    // Initialize
    function init() {
      initStyleSelector();
      initFilterTabs();
      renderPersonaList();

      document.getElementById('generateBtn').onclick = generateCards;
      document.getElementById('promptsToggle').onclick = togglePrompts;
      document.getElementById('panelClose').onclick = closePanel;
    }

    function initStyleSelector() {
      const selector = document.getElementById('styleSelector');
      selector.querySelectorAll('.style-btn').forEach(btn => {
        btn.onclick = () => {
          selector.querySelectorAll('.style-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          currentStyle = btn.dataset.style;
          document.getElementById('stylePromptText').textContent = visualStyles[currentStyle].prompt;
        };
      });
    }

    function initFilterTabs() {
      const tabs = document.getElementById('filterTabs');
      tabs.querySelectorAll('.filter-tab').forEach(tab => {
        tab.onclick = () => {
          tabs.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          currentFilter = tab.dataset.filter;
          renderPersonaList();
        };
      });
    }

    function renderPersonaList() {
      const list = document.getElementById('personaList');
      list.innerHTML = '';

      const filtered = currentFilter === 'all'
        ? personas
        : personas.filter(p => p.type === currentFilter);

      filtered.forEach(persona => {
        const btn = document.createElement('button');
        btn.className = 'persona-btn' + (selectedPersona?.id === persona.id ? ' active' : '');
        btn.innerHTML = `
          <img class="persona-avatar" src="${persona.avatar}" alt="${persona.name}" onerror="this.src='https://via.placeholder.com/80?text=${persona.name[0]}'">
          <div class="persona-btn-info">
            <div class="name">${persona.name}</div>
            <div class="role">${persona.role}</div>
          </div>
          ${persona.type === 'luminary' ? '<span class="persona-badge">Public Figure</span>' : ''}
        `;
        btn.onclick = () => selectPersona(persona);
        list.appendChild(btn);
      });
    }

    function selectPersona(persona) {
      selectedPersona = persona;
      currentCardIndex = 0;
      closePanel();

      renderPersonaList();

      // Show persona details
      document.getElementById('personaDetails').classList.add('visible');
      document.getElementById('personaBio').textContent = persona.bio;

      const memoriesEl = document.getElementById('personaMemories');
      memoriesEl.innerHTML = persona.memories.map(m => `<span class="memory-tag">${m}</span>`).join('');

      // Reset card stack
      document.getElementById('cardStack').innerHTML = `
        <div class="empty-state">
          <div class="icon">‚Üì</div>
          <p>Click "Generate Recommendations"<br>to create personalized cards</p>
        </div>
      `;
      document.getElementById('stackIndicator').innerHTML = '';
      document.getElementById('tapHint').style.display = 'none';
    }

    function togglePrompts() {
      showPrompts = !showPrompts;
      document.getElementById('promptsToggle').classList.toggle('active', showPrompts);

      document.querySelectorAll('.prompt-box').forEach(box => {
        box.classList.toggle('visible', showPrompts);
      });
    }

    function generateCards() {
      if (!selectedPersona) return;

      cards = topicsByPersona[selectedPersona.id] || topicsByPersona['tech-entrepreneur'];
      currentCardIndex = 0;

      document.getElementById('tapHint').style.display = 'block';
      renderCardStack();

      // Open panel with first card
      openPanel(cards[0]);
    }

    function renderCardStack() {
      const stack = document.getElementById('cardStack');
      stack.innerHTML = '';

      if (currentCardIndex >= cards.length) {
        stack.innerHTML = `
          <div class="done-state">
            <div class="checkmark">‚úì</div>
            <p>All caught up!</p>
          </div>
        `;
        document.getElementById('stackIndicator').innerHTML = '';
        document.getElementById('tapHint').style.display = 'none';
        closePanel();
        return;
      }

      const visibleCards = cards.slice(currentCardIndex, currentCardIndex + 3);

      visibleCards.reverse().forEach((card, reverseIndex) => {
        const actualIndex = visibleCards.length - 1 - reverseIndex;
        const cardEl = createCardElement(card, currentCardIndex + actualIndex);

        const offset = actualIndex * 8;
        const scale = 1 - (actualIndex * 0.03);
        cardEl.style.transform = `translateY(${offset}px) scale(${scale})`;
        cardEl.style.zIndex = visibleCards.length - actualIndex;

        if (actualIndex === 0) {
          enableSwipe(cardEl);
        }

        stack.appendChild(cardEl);
      });

      renderStackIndicator();

      if (panelOpen && cards[currentCardIndex]) {
        updatePanel(cards[currentCardIndex]);
      }
    }

    function createCardElement(card, index) {
      const cardEl = document.createElement('div');
      cardEl.className = 'card';
      cardEl.innerHTML = `
        <div class="card-bg" style="background-image: url('${card.image}')"></div>
        <div class="card-overlay"></div>
        <div class="card-content">
          <div class="card-topic">${card.topic}</div>
          <div class="card-headline">${card.headline}</div>
          <div class="card-subheadline">${card.subheadline}</div>
        </div>
        <div class="card-counter">${index + 1} / ${cards.length}</div>
        <div class="card-style-badge">${visualStyles[currentStyle].label}</div>
        <div class="swipe-hint left">SKIP</div>
        <div class="swipe-hint right">SAVE</div>
      `;

      cardEl.addEventListener('click', (e) => {
        if (!cardEl.classList.contains('dragging')) {
          openPanel(card);
        }
      });

      return cardEl;
    }

    function enableSwipe(cardEl) {
      let startX = 0;
      let currentX = 0;
      let isDragging = false;

      const onStart = (e) => {
        isDragging = true;
        cardEl.classList.add('dragging');
        startX = e.type === 'mousedown' ? e.clientX : e.touches[0].clientX;
      };

      const onMove = (e) => {
        if (!isDragging) return;

        const x = e.type === 'mousemove' ? e.clientX : e.touches[0].clientX;
        currentX = x - startX;

        const rotation = currentX * 0.05;
        cardEl.style.transform = `translateX(${currentX}px) rotate(${rotation}deg)`;

        const leftHint = cardEl.querySelector('.swipe-hint.left');
        const rightHint = cardEl.querySelector('.swipe-hint.right');

        leftHint.style.opacity = currentX < -50 ? Math.min(1, Math.abs(currentX + 50) / 100) : 0;
        rightHint.style.opacity = currentX > 50 ? Math.min(1, (currentX - 50) / 100) : 0;
      };

      const onEnd = () => {
        if (!isDragging) return;
        isDragging = false;

        setTimeout(() => {
          cardEl.classList.remove('dragging');
        }, 100);

        const threshold = 100;

        if (Math.abs(currentX) > threshold) {
          cardEl.classList.add('animating');
          const direction = currentX > 0 ? 1 : -1;
          cardEl.style.transform = `translateX(${direction * 500}px) rotate(${direction * 30}deg)`;
          cardEl.style.opacity = '0';

          setTimeout(() => {
            currentCardIndex++;
            renderCardStack();
          }, 300);
        } else {
          cardEl.classList.add('animating');
          cardEl.style.transform = 'translateX(0) rotate(0)';
          cardEl.querySelector('.swipe-hint.left').style.opacity = 0;
          cardEl.querySelector('.swipe-hint.right').style.opacity = 0;

          setTimeout(() => {
            cardEl.classList.remove('animating');
          }, 300);
        }

        currentX = 0;
      };

      cardEl.addEventListener('mousedown', onStart);
      cardEl.addEventListener('touchstart', onStart, { passive: true });

      document.addEventListener('mousemove', onMove);
      document.addEventListener('touchmove', onMove, { passive: true });

      document.addEventListener('mouseup', onEnd);
      document.addEventListener('touchend', onEnd);
    }

    function renderStackIndicator() {
      const indicator = document.getElementById('stackIndicator');
      indicator.innerHTML = cards.map((_, i) => {
        let className = 'stack-dot';
        if (i === currentCardIndex) className += ' active';
        else if (i < currentCardIndex) className += ' seen';
        return `<div class="${className}"></div>`;
      }).join('');
    }

    function openPanel(card) {
      panelOpen = true;
      updatePanel(card);
      document.getElementById('layout').classList.add('panel-open');
    }

    function updatePanel(card) {
      const apps = miniAppsByTopic[card.topic] || miniAppsByTopic['default'];

      document.getElementById('panelTitle').textContent = card.topic;
      document.getElementById('panelSubtitle').textContent = `${apps.length} mini-apps to explore`;

      const list = document.getElementById('miniAppsList');
      list.innerHTML = apps.map(app => `
        <div class="mini-app">
          <div class="mini-app-icon" style="background: ${app.color}">${app.icon}</div>
          <div class="mini-app-info">
            <h4>${app.name}</h4>
            <p>${app.desc}</p>
          </div>
          <div class="mini-app-arrow">‚Üí</div>
        </div>
      `).join('');
    }

    function closePanel() {
      panelOpen = false;
      document.getElementById('layout').classList.remove('panel-open');
    }

    init();
  </script>
</body>
</html>
